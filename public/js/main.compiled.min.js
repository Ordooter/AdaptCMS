// index
if ($('.ui.albums.search').length) {
	$(document).ready(function() {
		$('.ui.albums.search').search({
			apiSettings: {
				url: '/admin/api/albums?keyword={query}'
			},
			fields: {
				results : 'results',
				title   : 'name',
				url     : 'url'
			},
			minCharacters : 3
		});
	});

	var AdminAlbumsIndex = new Vue({
		el: 'table.albums',
		data: {
			items: []
		},
		ready: function() {
			var _this = this;
			$('.ui.checkbox').checkbox({
				onChange: function() {
					var items = [];

					$.each($('input[type="checkbox"]:checked'), function() {
						items.push($(this).attr('data-id'));
					});

					_this.items = items;
				}
			});
		},
		methods: {
			deleteMany: function() {
				if (confirm('Are you sure you wish to delete?')) {
					var _this = this;
					var data = {
						type: 'delete',
						many: true,
						ids: JSON.stringify(_this.items),
						_token: $('meta[name="csrf-token"]').attr('content')
					};
					
					$.post('/admin/albums/simple-save', data, function(response) {
						if (response.status) {
							_this.items = [];

							toastr.success('The album(s) have been deleted.');

							window.location.reload();
						} else {
							toastr.error('Could not delete album(s), please try again.');
						}
					});
				}
			}
		}
	});
}

// index
if ($('.ui.categories.search').length) {
	$(document).ready(function() {
		$('.ui.categories.search').search({
			apiSettings: {
				url: '/admin/api/categories?keyword={query}'
			},
			fields: {
				results : 'results',
				title   : 'name',
				url     : 'url'
			},
			minCharacters : 3
		});
	});

	var AdminCategoriesIndex = new Vue({
		el: 'table.categories',
		data: {
			items: []
		},
		ready: function() {
			var _this = this;
			$('.ui.checkbox').checkbox({
				onChange: function() {
					var items = [];

					$.each($('input[type="checkbox"]:checked'), function() {
						items.push($(this).attr('data-id'));
					});

					_this.items = items;
				}
			});
		},
		methods: {
			deleteMany: function() {
				if (confirm('Are you sure you wish to delete?')) {
					var _this = this;
					var data = {
						type: 'delete',
						many: true,
						ids: JSON.stringify(_this.items),
						_token: $('meta[name="csrf-token"]').attr('content')
					};
					
					$.post('/admin/categories/simple-save', data, function(response) {
						if (response.status) {
							_this.items = [];

							toastr.success('The categories have been deleted.');

							window.location.reload();
						} else {
							toastr.error('Could not delete categories, please try again.');
						}
					});
				}
			}
		}
	});
}

if ($(".sortable.categories").length) {
	$(".sortable.categories").sortable({
		onDrop: function($item, container, _super, event) {
			$item.removeClass(container.group.options.draggedClass).removeAttr("style");
			$("body").removeClass(container.group.options.bodyClass);

			var items = [];
			$.each($('.sortable li'), function() {
				items.push($(this).attr('data-id'));
			});

			var data = {
				items: JSON.stringify(items),
				_token: $('meta[name="csrf-token"]').attr('content')
			};

			$.post('/admin/categories/order', data, function(response) {
				toastr.success('Order has been saved.');
			}, 'json');
		}
	});
}

// index
if ($('.ui.fields.search').length) {
	$(document).ready(function() {
		$('.ui.fields.search').search({
			apiSettings: {
				url: '/admin/api/fields?keyword={query}'
			},
			fields: {
				results : 'results',
				title   : 'name',
				url     : 'url'
			},
			minCharacters : 3
		});
	});

	var AdminFieldsIndex = new Vue({
		el: 'table.fields',
		data: {
			items: []
		},
		ready: function() {
			var _this = this;
			$('.ui.checkbox').checkbox({
				onChange: function() {
					var items = [];

					$.each($('input[type="checkbox"]:checked'), function() {
						items.push($(this).attr('data-id'));
					});

					_this.items = items;
				}
			});
		},
		methods: {
			deleteMany: function() {
				if (confirm('Are you sure you wish to delete?')) {
					var _this = this;
					var data = {
						type: 'delete',
						many: true,
						ids: JSON.stringify(_this.items),
						_token: $('meta[name="csrf-token"]').attr('content')
					};
					
					$.post('/admin/fields/simple-save', data, function(response) {
						if (response.status) {
							_this.items = [];

							toastr.success('The fields have been deleted.');

							window.location.reload();
						} else {
							toastr.error('Could not delete fields, please try again.');
						}
					});
				}
			},
			toggleStatusesMany: function() {
				var _this = this;
				var data = {
					type: 'toggle-statuses',
					many: true,
					ids: JSON.stringify(_this.items),
					_token: $('meta[name="csrf-token"]').attr('content')
				};
				
				$.post('/admin/fields/simple-save', data, function(response) {
					if (response.status) {
						$('input[type="checkbox"]:checked').trigger('click');

						toastr.success('The fields have been saved.');

						window.location.reload();
					} else {
						toastr.error('Could not save fields, please try again.');
					}
				});
			}
		}
	});
}

if ($('.ui.form.fields').length) {
	new Vue({
		el: '.ui.form.fields',
		data: {
			name: '',
			caption: '',
			field_type: ''
		},
		methods: {
			updateCaption: function() {
				this.caption = S(this.name).humanize().s;
			}
		}
	});
}

if ($(".sortable.fields").length) {
	$(".sortable.fields").sortable({
		onDrop: function($item, container, _super, event) {
			$item.removeClass(container.group.options.draggedClass).removeAttr("style");
			$("body").removeClass(container.group.options.bodyClass);

			var items = [];
			$.each($('.sortable li'), function() {
				items.push($(this).attr('data-id'));
			});

			var data = {
				items: JSON.stringify(items),
				_token: $('meta[name="csrf-token"]').attr('content')
			};

			$.post('/admin/fields/order', data, function(response) {
				toastr.succes('Order has been saved.');
			}, 'json');
		}
	});
}

// index
if ($('.ui.files.search').length) {
	$(document).ready(function() {
		$('.ui.files.search').search({
			apiSettings: {
				url: '/admin/api/files?keyword={query}'
			},
			fields: {
				results : 'results',
				title   : 'filename',
				url     : 'url'
			},
			minCharacters : 3
		});
	});

	var AdminFilesIndex = new Vue({
		el: 'table.files',
		data: {
			items: []
		},
		ready: function() {
			var _this = this;
			$('.ui.checkbox').checkbox({
				onChange: function() {
					var items = [];

					$.each($('input[type="checkbox"]:checked'), function() {
						items.push($(this).attr('data-id'));
					});

					_this.items = items;
				}
			});
		},
		methods: {
			deleteMany: function() {
				if (confirm('Are you sure you wish to delete?')) {
					var _this = this;
					var data = {
						type: 'delete',
						many: true,
						ids: JSON.stringify(_this.items),
						_token: $('meta[name="csrf-token"]').attr('content')
					};
					
					$.post('/admin/files/simple-save', data, function(response) {
						if (response.status) {
							_this.items = [];

							toastr.success('The files have been deleted.');

							window.location.reload();
						} else {
							toastr.error('Could not delete files, please try again.');
						}
					});
				}
			}
		}
	});
}

// index
if ($('.ui.pages.search').length) {
	$(document).ready(function() {
		$('.ui.pages.search')
		.search({
			apiSettings: {
				url: '/admin/api/pages?keyword={query}'
			},
			fields: {
				results : 'results',
				title   : 'name',
				url     : 'url'
			},
			minCharacters : 3
		});
	});

	var AdminPagesIndex = new Vue({
		el: 'table.pages',
		data: {
			items: []
		},
		ready: function() {
			var _this = this;
			$('.ui.checkbox').checkbox({
				onChange: function() {
					var items = [];

					$.each($('input[type="checkbox"]:checked'), function() {
						items.push($(this).attr('data-id'));
					});

					_this.items = items;
				}
			});
		},
		methods: {
			deleteMany: function() {
				if (confirm('Are you sure you wish to delete?')) {
					var _this = this;
					var data = {
						type: 'delete',
						many: true,
						ids: JSON.stringify(_this.items),
						_token: $('meta[name="csrf-token"]').attr('content')
					};
					
					$.post('/admin/pages/simple-save', data, function(response) {
						if (response.status) {
							_this.items = [];

							toastr.success('The pages have been deleted.');

							window.location.reload();
						} else {
							toastr.error('Could not delete pages, please try again.');
						}
					});
				}
			},
			toggleStatusesMany: function() {
				var _this = this;
				var data = {
					type: 'toggle-statuses',
					many: true,
					ids: JSON.stringify(_this.items),
					_token: $('meta[name="csrf-token"]').attr('content')
				};
				
				$.post('/admin/pages/simple-save', data, function(response) {
					if (response.status) {
						$('input[type="checkbox"]:checked').trigger('click');

						toastr.success('The pages have been saved.');

						window.location.reload();
					} else {
						toastr.error('Could not save pages, please try again.');
					}
				});
			}
		}
	});
}

$(document).ready(function() {
	if ($('.ui.form.pages').length) {
		new Vue({
			el: '.ui.form.pages',
			data: {
				name: '',
				slug: '',
				initRan: false
			},
			watch: {
				name: function(newVal) {
					if (this.initRan) {
						this.slug = slugify(newVal);
					}

					if (!this.initRan) {
						this.initRan = true;
					}
				}
			}
		});
	}
});

if ($(".sortable.pages").length) {
	$(".sortable.pages").sortable({
		onDrop: function($item, container, _super, event) {
			$item.removeClass(container.group.options.draggedClass).removeAttr("style");
			$("body").removeClass(container.group.options.bodyClass);

			var items = [];
			$.each($('.sortable li'), function() {
				items.push($(this).attr('data-id'));
			});

			var data = {
				items: JSON.stringify(items),
				_token: $('meta[name="csrf-token"]').attr('content')
			};

			$.post('/admin/pages/order', data, function(response) {
				toastr.success('Order has been saved.');
			}, 'json');
		}
	});
}

// index
if ($('.ui.posts.search').length) {
	$(document).ready(function() {
		$('.ui.posts.search').search({
			apiSettings: {
				url: '/admin/api/posts?keyword={query}'
			},
			fields: {
				results : 'results',
				title   : 'name',
				url     : 'url'
			},
			minCharacters : 3
		});
	});

	var AdminPostsIndex = new Vue({
		el: 'table.posts',
		data: {
			items: []
		},
		ready: function() {
			var _this = this;
			$('.ui.checkbox').checkbox({
				onChange: function() {
					var items = [];

					$.each($('input[type="checkbox"]:checked'), function() {
						items.push($(this).attr('data-id'));
					});

					_this.items = items;
				}
			});
		},
		methods: {
			deleteMany: function() {
				if (confirm('Are you sure you wish to delete?')) {
					var _this = this;
					var data = {
						type: 'delete',
						many: true,
						ids: JSON.stringify(_this.items),
						_token: $('meta[name="csrf-token"]').attr('content')
					};
					
					$.post('/admin/posts/simple-save', data, function(response) {
						if (response.status) {
							_this.items = [];

							toastr.success('The posts have been deleted.');

							window.location.reload();
						} else {
							toastr.error('Could not delete posts, please try again.');
						}
					});
				}
			},
			toggleStatusesMany: function() {
				var _this = this;
				var data = {
					type: 'toggle-statuses',
					many: true,
					ids: JSON.stringify(_this.items),
					_token: $('meta[name="csrf-token"]').attr('content')
				};
				
				$.post('/admin/posts/simple-save', data, function(response) {
					if (response.status) {
						$('input[type="checkbox"]:checked').trigger('click');

						toastr.success('The posts have been saved.');

						window.location.reload();
					} else {
						toastr.error('Could not save posts, please try again.');
					}
				});
			}
		}
	});
}

$(document).ready(function() {
	if ($('.ui.form.posts').length) {
		new Vue({
			el: '.ui.form.posts',
			data: {
				name: '',
				slug: '',
				initRan: false
			},
			watch: {
				name: function(newVal) {
					if (this.initRan) {
						this.slug = slugify(newVal);
					}

					if (!this.initRan) {
						this.initRan = true;
					}
				}
			}
		});
	}
});

// add/edit
if ($('#AdminArticlesApp').length) {
	var AdminArticlesApp = new Vue({
		el: '#AdminArticlesApp',
		created: function() {

		}
	});

	if ($('#datepicker').lenth) {
		new DatePicker({ dataFields: [document.getElementById('datepicker')] });
	}
}

if ($('div.settings').length) {
    new Vue({
		el: 'div.settings',
		data: {
		    items: []
		},
		ready: function() {
		    var _this = this;
		    $('.ui.checkbox').checkbox({
				onChange: function() {
				    var items = [];
		
				    $.each($('input[type="checkbox"]:checked'), function() {
						items.push($(this).attr('data-id'));
				    });
		
				    _this.items = items;
				}
		    });
		},
		methods: {
		    saveSettings: function() {
				var _this = this;
				var settings = [];
		
				$.each($('.setting'), function() {
				    settings.push({
					key: $(this).attr('data-key'),
					value: $(this).val()
					});
				});
	
				var data = { 
					type: 'save', 
					many: true, 
					data: settings, 
					_token: $('meta[name="csrf-token"]').attr('content')
				};
		
				$.post('/admin/settings/simple-save', data, function(response) {
				    if (response.status) {
						toastr.success('The settings have been saved.');
				    } else {
						toastr.error('Could not save settings, please try again.');
				    }
				});
		    },
		    deleteMany: function() {
				if (confirm('Are you sure you wish to delete?')) {
				    var _this = this;
					var data = {
						type: 'delete',
						many: true,
						ids: JSON.stringify(_this.items),
						_token: $('meta[name="csrf-token"]').attr('content')
					};
					
				    $.post('/admin/settings/simple-save', data, function(response) {
						if (response.status) {
						    _this.items = [];
			
						    toastr.success('The settings have been deleted.');

						    window.location.reload();
						} else {
						    toastr.error('Could not delete settings, please try again.');
						}
				    });
				}
		    }
		}
    });
}

// index
if ($('.ui.tags.search').length) {
	$(document).ready(function() {
		$('.ui.tags.search').search({
			apiSettings: {
				url: '/admin/api/tags?keyword={query}'
			},
			fields: {
				results : 'results',
				title   : 'name',
				url     : 'url'
			},
			minCharacters : 3
		});
	});

	var AdminTagsIndex = new Vue({
		el: 'table.tags',
		data: {
			items: []
		},
		ready: function() {
			var _this = this;
			$('.ui.checkbox').checkbox({
				onChange: function() {
					var items = [];

					$.each($('input[type="checkbox"]:checked'), function() {
						items.push($(this).attr('data-id'));
					});

					_this.items = items;
				}
			});
		},
		methods: {
			deleteMany: function() {
				if (confirm('Are you sure you wish to delete?')) {
					var _this = this;
					var data = {
						type: 'delete',
						many: true,
						ids: JSON.stringify(_this.items),
						_token: $('meta[name="csrf-token"]').attr('content')
					};
					
					$.post('/admin/tags/simple-save', data, function(response) {
						if (response.status) {
							_this.items = [];

							toastr.success('The tags have been deleted.');

							window.location.reload();
						} else {
							toastr.error('Could not delete tags, please try again.');
						}
					});
				}
			},
			toggleStatusesMany: function() {
				var _this = this;
				var data = {
					type: 'toggle-statuses',
					many: true,
					ids: JSON.stringify(_this.items),
					_token: $('meta[name="csrf-token"]').attr('content')
				};
				
				$.post('/admin/tags/simple-save', data, function(response) {
					if (response.status) {
						$('input[type="checkbox"]:checked').trigger('click');

						toastr.success('The tags have been saved.');

						window.location.reload();
					} else {
						toastr.error('Could not save tags, please try again.');
					}
				});
			}
		}
	});
}

// index
if ($('table.themes').length) {
	var AdminThemesIndex = new Vue({
		el: 'table.themes',
		data: {
			items: []
		},
		ready: function() {
			var _this = this;
			$('.ui.checkbox').checkbox({
				onChange: function() {
					var items = [];

					$.each($('input[type="checkbox"]:checked'), function() {
						items.push($(this).attr('data-id'));
					});

					_this.items = items;
				}
			});
		},
		methods: {
			deleteMany: function() {
				if (confirm('Are you sure you wish to delete?')) {
					var _this = this;
					var data = {
						type: 'delete',
						many: true,
						ids: JSON.stringify(_this.items),
						_token: $('meta[name="csrf-token"]').attr('content')
					};
					
					$.post('/admin/themes/simple-save', data, function(response) {
						if (response.status) {
							_this.items = [];

							toastr.success('The themes have been deleted.');

							window.location.reload();
						} else {
							toastr.error('Could not delete themes, please try again.');
						}
					});
				}
			},
			toggleStatusesMany: function() {
				var _this = this;
				var data = {
					type: 'toggle-statuses',
					many: true,
					ids: JSON.stringify(_this.items),
					_token: $('meta[name="csrf-token"]').attr('content')
				};
				
				$.post('/admin/themes/simple-save', data, function(response) {
					if (response.status) {
						$('input[type="checkbox"]:checked').trigger('click');

						toastr.success('The themes have been saved.');

						window.location.reload();
					} else {
						toastr.error('Could not save themes, please try again.');
					}
				});
			}
		}
	});
}

var moduleUpdates = [
    {
        'name': 'Plugin',
        'slug': 'plugin'
    },
    {
        'name': 'Theme',
        'slug': 'theme'
    }
];

_.each(moduleUpdates, function(module) {
    var updatesApp = $('.ui.table.' + module.slug + 's.update');
    if (updatesApp.length) {
        new Vue({
            el: '.ui.table.' + module.slug + 's.update',
            data: {
                module_ids: {}
            },
            methods: {
                update: function() {
                	var message = 'Are you sure you wish to update these ' + module.slug + '(s)?';
                	
                    if (confirm(message)) {
                        var data = {
                            module_ids: this.module_ids,
                            _token: $('meta[name="csrf-token"]').attr('content')
                        };

                        $.post('/admin/updates/update/' + module.slug + 's', data, function(response) {
                            if (response.status) {
                                toastr.success(module.name + '(s) have been installed!');
                            } else {
                                toastr.error('Could not install, sorry!');
                            }
                        }, 'json');
                    }
                },
                updateAll: function() {
                    $.each($(module.slug + '-id'), function() {
                        $(this).attr('checked', 'checked');
                    });

                    setTimeout(function() {
                        _this.update();
                    }, 50);
                }
            }
        });
    }
});

// index
if ($('.ui.users.search').length) {
	$(document).ready(function() {
		$('.ui.users.search').search({
			apiSettings: {
				url: '/admin/api/users?keyword={query}'
			},
			fields: {
				results : 'results',
				title   : 'username',
				url     : 'url'
			},
			minCharacters : 3
		});
	});

	var AdminUsersIndex = new Vue({
		el: 'table.users',
		data: {
			items: []
		},
		ready: function() {
			var _this = this;
			$('.ui.checkbox').checkbox({
				onChange: function() {
					var items = [];

					$.each($('input[type="checkbox"]:checked'), function() {
						items.push($(this).attr('data-id'));
					});

					_this.items = items;
				}
			});
		},
		methods: {
			deleteMany: function() {
				if (confirm('Are you sure you wish to delete?')) {
					var _this = this;
					var data = {
						type: 'delete',
						many: true,
						ids: JSON.stringify(_this.items),
						_token: $('meta[name="csrf-token"]').attr('content')
					};
					
					$.post('/admin/users/simple-save', data, function(response) {
						if (response.status) {
							_this.items = [];

							toastr.success('The users have been deleted.');

							window.location.reload();
						} else {
							toastr.error('Could not delete users, please try again.');
						}
					});
				}
			},
			toggleStatusesMany: function() {
				var _this = this;
				var data = {
					type: 'toggle-statuses',
					many: true,
					ids: JSON.stringify(_this.items),
					_token: $('meta[name="csrf-token"]').attr('content')
				};
				$.post('/admin/users/simple-save', data, function(response) {
					if (response.status) {
						$('input[type="checkbox"]:checked').trigger('click');

						toastr.success('The users have been saved.');

						window.location.reload();
					} else {
						toastr.error('Could not save users, please try again.');
					}
				});
			}
		}
	});
}

$(document).ready(function() {
    if ($('body.install.database').length) {
        new Vue({
            el: '.ui.segment',
            data: {
                database_connection: false,
                filled_out: false,
                'DB_HOST': 'localhost',
                'DB_PORT': '3306',
                'DB_DATABASE': '',
                'DB_USERNAME': 'root',
                'DB_PASSWORD': '',
                'sitename': '',
                fields: [
                    'DB_HOST',
                    'DB_PORT',
                    'DB_DATABASE',
                    'DB_USERNAME',
                    'DB_PASSWORD'
                ]
            },
            methods: {
                testConnection: function() {
                    var _this = this;

                    var data = {};
                    _.each(this.fields, function(key) {
                        data[key] = _this[key];
                    });

                    data._token = $('meta[name="csrf-token"]').attr('content');

                    // TEMPORARY
                    // gotta write it and try it on the second attempt
                    $.post('/install/database', data, function() {
                        $.post('/install/database', data, function(response) {
                            if (response.status) {
                                toastr.success('Database connection is a-go!');
                            } else {
                                toastr.error('No dice! Try again please.');
                            }

                            _this.database_connection = response.status;
                        }, 'json');
                    });
                },
                isFilledOut: function() {
                    var _this = this;

                    var filled_out = true;
                    _.each(this.fields, function(key) {
                        if (!_this[key].length && key !== 'DB_PASSWORD') {
                            filled_out = false;
                        }
                    });

                    this.filled_out = filled_out;
                }
            },
            watch: {
                DB_HOST: function(newVal) {
                    this.isFilledOut();
                },
                DB_PORT: function(newVal) {
                    this.isFilledOut();
                },
                DB_DATABASE: function(newVal) {
                    this.isFilledOut();
                },
                DB_USERNAME: function(newVal) {
                    this.isFilledOut();
                }
            }
        })
    }
});

$(document).ajaxError(function(event, jqxhr, settings, thrownError) {
    toastr.error('Uh-oh! Got an error from the server. For the devs, it was a "' + thrownError + '" error, specifically.');
});

$(document).ready(function() {
    if ($('.ui.dropdown:not(.cms)').length) {
        $('.ui.dropdown:not(.cms)').dropdown({
            on: 'hover'
        });
    }

    if ($('.ui.dropdown.cms').length) {
        $('.ui.dropdown.cms').on('click', function() {
            $(this).find('.menu').toggleClass('active');
        });
    }

    var closeMenu = $('.ui.close-menu');
    if (closeMenu.length) {
        closeMenu.on('click', function(e) {
            e.preventDefault();

            $('body').trigger('click');
        });
    }

    let popups = $('.activate.popup')
    if (popups.length) {
      popups.popup({
        inline: true,
        hoverable: true,
        lastResort: true,
        position: 'right center'
      })
    }

    $('.btn-confirm').on('click', function(e) {
        if (confirm('Are you sure you wish to delete?')) {
            return true;
        } else {
            e.preventDefault();
        }
    });

    if ($('.tagsInput').length) {
        $('.tagsInput').tagsInput();
    }

    if ($('div.calendar').length) {
        $('div.calendar').calendar({
            type: 'date',
            popupOptions: {
                position: 'right center'
            }
        });
    }

    if ($('.tabs.menu').length) {
        $('.tabs.menu .item').tab();
    }

    if ($('select.dropdown').length) {
        $('select.dropdown').dropdown();
    }

    var dropdowns = $('.ui.dropdown.allowAdditions');
    if (dropdowns.length) {
        dropdowns.dropdown({
            allowAdditions: true
        });
    }

    var message = $('.ui.message .close');
    if (message.length) {
        message.on('click', function() {
            message.toggleClass('hidden');
        });
    }

    var modules_search = $('.ui.search.modules');
    if (modules_search.length) {
        modules_search.search({
            apiSettings: {
                url: 'https://marketplace.adaptcms.com/api/search?q={query}'
            },
            fields: {
                results: 'items',
                title: 'name',
                url: 'install_url'
            },
            minCharacters: 3
        });
    }

    var plugins_search = $('.ui.search.plugins');
    if (plugins_search.length) {
        plugins_search.search({
            apiSettings: {
                url: 'https://marketplace.adaptcms.com/api/search/plugin?q={query}'
            },
            fields: {
                results: 'items',
                title: 'name',
                url: 'install_url'
            },
            minCharacters: 3
        });
    }

    var themes_search = $('.ui.search.themes');
    if (themes_search.length) {
        themes_search.search({
            apiSettings: {
                url: 'https://marketplace.adaptcms.com/api/search/theme?q={query}'
            },
            fields: {
                results: 'items',
                title: 'name',
                url: 'install_url'
            },
            minCharacters: 3
        });
    }

    var ratings = $('.ui.rating');
    if (ratings.length) {
        $.each(ratings, function() {
            var _this = $(this);

            var settings = {
                /*
                onRate: function(rating) {
                  $.post(_this.attr('data-href'), { rating: rating }, function(response) {
                    if (response.status) {
                      toastr.success('Rating saved');

                      if (_this.next().hasClass('numbers')) {
                        _this.next().html('(' + response.new_total_ratings + ')');
                      }
                    } else {
                      toastr.error('Could not save rating, try again!');
                    }
                  });
                }
                */
            };

            if ($(this).hasClass('disabled')) {
                $(this).rating('disable');
            } else {
                $(this).rating(settings);
            }
        });
    }

    var special_cards = $('.special.cards .image');
    if (special_cards.length) {
        special_cards.dimmer({
            on: 'hover'
        });
    }

    var collapsible_items = $('.item.collapsible');
    if (collapsible_items.length) {
        // toggle collapsible menu
        $('.item.collapsible .header').click(function(e) {
            e.preventDefault();

            var menu = $(this).parent().find('.menu');

            // so it will be active
            if (menu.hasClass('hidden')) {
                $(this).find('.icon').removeClass('right').addClass('down');
            } else {
                // otherwise, inactive
                $(this).find('.icon').removeClass('down').addClass('right');
            }

            menu.toggleClass('hidden');
        });

        // add active classes to menu div's
        // if on current URL
        $.each(collapsible_items, function() {
            if ($(this).find('.menu .item.active').length) {
                $(this).addClass('active');
                $(this).find('.header').trigger('click');
            }
        });
    }

    if ($('.toc.item').length) {
        $('.ui.sidebar').sidebar('attach events', '.toc.item');
    }

    // wysiwyg editors
    var wysiwyg = $('.wysiwyg');
    if (wysiwyg.length) {
        $.each(wysiwyg, function() {
            if ($(this).hasClass('code-view') && $('.api-call').length) {
                var textarea = $(this).get(0);
                var api_url = $('.api-call').attr('data-url');

                $.get(api_url, function(response) {
                    var editor = CodeMirror.fromTextArea(textarea, {
                        mode: 'scheme',
                        lineNumbers: true
                    });

                    try {
                        editor.getDoc().setValue(response.results[0].body);
                    } catch (error) {
                        // do nothing, no value present
                    }
                }, 'json');
            } else {
                CKEDITOR.replace($(this).attr('id'));
            }
        });
    }
});

// Source: https://gist.github.com/mathewbyrne/1280286
function slugify(text) {
    return text.toString().toLowerCase()
        .replace(/\s+/g, '-') // Replace spaces with -
        .replace(/[^\w\-]+/g, '') // Remove all non-word chars
        .replace(/\-\-+/g, '-') // Replace multiple - with single -
        .replace(/^-+/, '') // Trim - from start of text
        .replace(/-+$/, ''); // Trim - from end of text
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkbWluLmFsYnVtcy5qcyIsImFkbWluLmNhdGVnb3JpZXMuanMiLCJhZG1pbi5maWVsZHMuanMiLCJhZG1pbi5maWxlcy5qcyIsImFkbWluLnBhZ2VzLmpzIiwiYWRtaW4ucG9zdHMuanMiLCJhZG1pbi5zZXR0aW5ncy5qcyIsImFkbWluLnRhZ3MuanMiLCJhZG1pbi50aGVtZXMuanMiLCJhZG1pbi51cGRhdGVzLmpzIiwiYWRtaW4udXNlcnMuanMiLCJpbnN0YWxsLmpzIiwiYmFzZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25JQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoibWFpbi5jb21waWxlZC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBpbmRleFxuaWYgKCQoJy51aS5hbGJ1bXMuc2VhcmNoJykubGVuZ3RoKSB7XG5cdCQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuXHRcdCQoJy51aS5hbGJ1bXMuc2VhcmNoJykuc2VhcmNoKHtcblx0XHRcdGFwaVNldHRpbmdzOiB7XG5cdFx0XHRcdHVybDogJy9hZG1pbi9hcGkvYWxidW1zP2tleXdvcmQ9e3F1ZXJ5fSdcblx0XHRcdH0sXG5cdFx0XHRmaWVsZHM6IHtcblx0XHRcdFx0cmVzdWx0cyA6ICdyZXN1bHRzJyxcblx0XHRcdFx0dGl0bGUgICA6ICduYW1lJyxcblx0XHRcdFx0dXJsICAgICA6ICd1cmwnXG5cdFx0XHR9LFxuXHRcdFx0bWluQ2hhcmFjdGVycyA6IDNcblx0XHR9KTtcblx0fSk7XG5cblx0dmFyIEFkbWluQWxidW1zSW5kZXggPSBuZXcgVnVlKHtcblx0XHRlbDogJ3RhYmxlLmFsYnVtcycsXG5cdFx0ZGF0YToge1xuXHRcdFx0aXRlbXM6IFtdXG5cdFx0fSxcblx0XHRyZWFkeTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgX3RoaXMgPSB0aGlzO1xuXHRcdFx0JCgnLnVpLmNoZWNrYm94JykuY2hlY2tib3goe1xuXHRcdFx0XHRvbkNoYW5nZTogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0dmFyIGl0ZW1zID0gW107XG5cblx0XHRcdFx0XHQkLmVhY2goJCgnaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdOmNoZWNrZWQnKSwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRpdGVtcy5wdXNoKCQodGhpcykuYXR0cignZGF0YS1pZCcpKTtcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdF90aGlzLml0ZW1zID0gaXRlbXM7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0sXG5cdFx0bWV0aG9kczoge1xuXHRcdFx0ZGVsZXRlTWFueTogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGlmIChjb25maXJtKCdBcmUgeW91IHN1cmUgeW91IHdpc2ggdG8gZGVsZXRlPycpKSB7XG5cdFx0XHRcdFx0dmFyIF90aGlzID0gdGhpcztcblx0XHRcdFx0XHR2YXIgZGF0YSA9IHtcblx0XHRcdFx0XHRcdHR5cGU6ICdkZWxldGUnLFxuXHRcdFx0XHRcdFx0bWFueTogdHJ1ZSxcblx0XHRcdFx0XHRcdGlkczogSlNPTi5zdHJpbmdpZnkoX3RoaXMuaXRlbXMpLFxuXHRcdFx0XHRcdFx0X3Rva2VuOiAkKCdtZXRhW25hbWU9XCJjc3JmLXRva2VuXCJdJykuYXR0cignY29udGVudCcpXG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHQkLnBvc3QoJy9hZG1pbi9hbGJ1bXMvc2ltcGxlLXNhdmUnLCBkYXRhLCBmdW5jdGlvbihyZXNwb25zZSkge1xuXHRcdFx0XHRcdFx0aWYgKHJlc3BvbnNlLnN0YXR1cykge1xuXHRcdFx0XHRcdFx0XHRfdGhpcy5pdGVtcyA9IFtdO1xuXG5cdFx0XHRcdFx0XHRcdHRvYXN0ci5zdWNjZXNzKCdUaGUgYWxidW0ocykgaGF2ZSBiZWVuIGRlbGV0ZWQuJyk7XG5cblx0XHRcdFx0XHRcdFx0d2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0dG9hc3RyLmVycm9yKCdDb3VsZCBub3QgZGVsZXRlIGFsYnVtKHMpLCBwbGVhc2UgdHJ5IGFnYWluLicpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcbn1cbiIsIi8vIGluZGV4XG5pZiAoJCgnLnVpLmNhdGVnb3JpZXMuc2VhcmNoJykubGVuZ3RoKSB7XG5cdCQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuXHRcdCQoJy51aS5jYXRlZ29yaWVzLnNlYXJjaCcpLnNlYXJjaCh7XG5cdFx0XHRhcGlTZXR0aW5nczoge1xuXHRcdFx0XHR1cmw6ICcvYWRtaW4vYXBpL2NhdGVnb3JpZXM/a2V5d29yZD17cXVlcnl9J1xuXHRcdFx0fSxcblx0XHRcdGZpZWxkczoge1xuXHRcdFx0XHRyZXN1bHRzIDogJ3Jlc3VsdHMnLFxuXHRcdFx0XHR0aXRsZSAgIDogJ25hbWUnLFxuXHRcdFx0XHR1cmwgICAgIDogJ3VybCdcblx0XHRcdH0sXG5cdFx0XHRtaW5DaGFyYWN0ZXJzIDogM1xuXHRcdH0pO1xuXHR9KTtcblxuXHR2YXIgQWRtaW5DYXRlZ29yaWVzSW5kZXggPSBuZXcgVnVlKHtcblx0XHRlbDogJ3RhYmxlLmNhdGVnb3JpZXMnLFxuXHRcdGRhdGE6IHtcblx0XHRcdGl0ZW1zOiBbXVxuXHRcdH0sXG5cdFx0cmVhZHk6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIF90aGlzID0gdGhpcztcblx0XHRcdCQoJy51aS5jaGVja2JveCcpLmNoZWNrYm94KHtcblx0XHRcdFx0b25DaGFuZ2U6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHZhciBpdGVtcyA9IFtdO1xuXG5cdFx0XHRcdFx0JC5lYWNoKCQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXTpjaGVja2VkJyksIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0aXRlbXMucHVzaCgkKHRoaXMpLmF0dHIoJ2RhdGEtaWQnKSk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRfdGhpcy5pdGVtcyA9IGl0ZW1zO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9LFxuXHRcdG1ldGhvZHM6IHtcblx0XHRcdGRlbGV0ZU1hbnk6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRpZiAoY29uZmlybSgnQXJlIHlvdSBzdXJlIHlvdSB3aXNoIHRvIGRlbGV0ZT8nKSkge1xuXHRcdFx0XHRcdHZhciBfdGhpcyA9IHRoaXM7XG5cdFx0XHRcdFx0dmFyIGRhdGEgPSB7XG5cdFx0XHRcdFx0XHR0eXBlOiAnZGVsZXRlJyxcblx0XHRcdFx0XHRcdG1hbnk6IHRydWUsXG5cdFx0XHRcdFx0XHRpZHM6IEpTT04uc3RyaW5naWZ5KF90aGlzLml0ZW1zKSxcblx0XHRcdFx0XHRcdF90b2tlbjogJCgnbWV0YVtuYW1lPVwiY3NyZi10b2tlblwiXScpLmF0dHIoJ2NvbnRlbnQnKVxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0JC5wb3N0KCcvYWRtaW4vY2F0ZWdvcmllcy9zaW1wbGUtc2F2ZScsIGRhdGEsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cdFx0XHRcdFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzKSB7XG5cdFx0XHRcdFx0XHRcdF90aGlzLml0ZW1zID0gW107XG5cblx0XHRcdFx0XHRcdFx0dG9hc3RyLnN1Y2Nlc3MoJ1RoZSBjYXRlZ29yaWVzIGhhdmUgYmVlbiBkZWxldGVkLicpO1xuXG5cdFx0XHRcdFx0XHRcdHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHRvYXN0ci5lcnJvcignQ291bGQgbm90IGRlbGV0ZSBjYXRlZ29yaWVzLCBwbGVhc2UgdHJ5IGFnYWluLicpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcbn1cblxuaWYgKCQoXCIuc29ydGFibGUuY2F0ZWdvcmllc1wiKS5sZW5ndGgpIHtcblx0JChcIi5zb3J0YWJsZS5jYXRlZ29yaWVzXCIpLnNvcnRhYmxlKHtcblx0XHRvbkRyb3A6IGZ1bmN0aW9uKCRpdGVtLCBjb250YWluZXIsIF9zdXBlciwgZXZlbnQpIHtcblx0XHRcdCRpdGVtLnJlbW92ZUNsYXNzKGNvbnRhaW5lci5ncm91cC5vcHRpb25zLmRyYWdnZWRDbGFzcykucmVtb3ZlQXR0cihcInN0eWxlXCIpO1xuXHRcdFx0JChcImJvZHlcIikucmVtb3ZlQ2xhc3MoY29udGFpbmVyLmdyb3VwLm9wdGlvbnMuYm9keUNsYXNzKTtcblxuXHRcdFx0dmFyIGl0ZW1zID0gW107XG5cdFx0XHQkLmVhY2goJCgnLnNvcnRhYmxlIGxpJyksIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRpdGVtcy5wdXNoKCQodGhpcykuYXR0cignZGF0YS1pZCcpKTtcblx0XHRcdH0pO1xuXG5cdFx0XHR2YXIgZGF0YSA9IHtcblx0XHRcdFx0aXRlbXM6IEpTT04uc3RyaW5naWZ5KGl0ZW1zKSxcblx0XHRcdFx0X3Rva2VuOiAkKCdtZXRhW25hbWU9XCJjc3JmLXRva2VuXCJdJykuYXR0cignY29udGVudCcpXG5cdFx0XHR9O1xuXG5cdFx0XHQkLnBvc3QoJy9hZG1pbi9jYXRlZ29yaWVzL29yZGVyJywgZGF0YSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0dG9hc3RyLnN1Y2Nlc3MoJ09yZGVyIGhhcyBiZWVuIHNhdmVkLicpO1xuXHRcdFx0fSwgJ2pzb24nKTtcblx0XHR9XG5cdH0pO1xufVxuIiwiLy8gaW5kZXhcbmlmICgkKCcudWkuZmllbGRzLnNlYXJjaCcpLmxlbmd0aCkge1xuXHQkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcblx0XHQkKCcudWkuZmllbGRzLnNlYXJjaCcpLnNlYXJjaCh7XG5cdFx0XHRhcGlTZXR0aW5nczoge1xuXHRcdFx0XHR1cmw6ICcvYWRtaW4vYXBpL2ZpZWxkcz9rZXl3b3JkPXtxdWVyeX0nXG5cdFx0XHR9LFxuXHRcdFx0ZmllbGRzOiB7XG5cdFx0XHRcdHJlc3VsdHMgOiAncmVzdWx0cycsXG5cdFx0XHRcdHRpdGxlICAgOiAnbmFtZScsXG5cdFx0XHRcdHVybCAgICAgOiAndXJsJ1xuXHRcdFx0fSxcblx0XHRcdG1pbkNoYXJhY3RlcnMgOiAzXG5cdFx0fSk7XG5cdH0pO1xuXG5cdHZhciBBZG1pbkZpZWxkc0luZGV4ID0gbmV3IFZ1ZSh7XG5cdFx0ZWw6ICd0YWJsZS5maWVsZHMnLFxuXHRcdGRhdGE6IHtcblx0XHRcdGl0ZW1zOiBbXVxuXHRcdH0sXG5cdFx0cmVhZHk6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIF90aGlzID0gdGhpcztcblx0XHRcdCQoJy51aS5jaGVja2JveCcpLmNoZWNrYm94KHtcblx0XHRcdFx0b25DaGFuZ2U6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHZhciBpdGVtcyA9IFtdO1xuXG5cdFx0XHRcdFx0JC5lYWNoKCQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXTpjaGVja2VkJyksIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0aXRlbXMucHVzaCgkKHRoaXMpLmF0dHIoJ2RhdGEtaWQnKSk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRfdGhpcy5pdGVtcyA9IGl0ZW1zO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9LFxuXHRcdG1ldGhvZHM6IHtcblx0XHRcdGRlbGV0ZU1hbnk6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRpZiAoY29uZmlybSgnQXJlIHlvdSBzdXJlIHlvdSB3aXNoIHRvIGRlbGV0ZT8nKSkge1xuXHRcdFx0XHRcdHZhciBfdGhpcyA9IHRoaXM7XG5cdFx0XHRcdFx0dmFyIGRhdGEgPSB7XG5cdFx0XHRcdFx0XHR0eXBlOiAnZGVsZXRlJyxcblx0XHRcdFx0XHRcdG1hbnk6IHRydWUsXG5cdFx0XHRcdFx0XHRpZHM6IEpTT04uc3RyaW5naWZ5KF90aGlzLml0ZW1zKSxcblx0XHRcdFx0XHRcdF90b2tlbjogJCgnbWV0YVtuYW1lPVwiY3NyZi10b2tlblwiXScpLmF0dHIoJ2NvbnRlbnQnKVxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0JC5wb3N0KCcvYWRtaW4vZmllbGRzL3NpbXBsZS1zYXZlJywgZGF0YSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMpIHtcblx0XHRcdFx0XHRcdFx0X3RoaXMuaXRlbXMgPSBbXTtcblxuXHRcdFx0XHRcdFx0XHR0b2FzdHIuc3VjY2VzcygnVGhlIGZpZWxkcyBoYXZlIGJlZW4gZGVsZXRlZC4nKTtcblxuXHRcdFx0XHRcdFx0XHR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHR0b2FzdHIuZXJyb3IoJ0NvdWxkIG5vdCBkZWxldGUgZmllbGRzLCBwbGVhc2UgdHJ5IGFnYWluLicpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXHRcdFx0dG9nZ2xlU3RhdHVzZXNNYW55OiBmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIF90aGlzID0gdGhpcztcblx0XHRcdFx0dmFyIGRhdGEgPSB7XG5cdFx0XHRcdFx0dHlwZTogJ3RvZ2dsZS1zdGF0dXNlcycsXG5cdFx0XHRcdFx0bWFueTogdHJ1ZSxcblx0XHRcdFx0XHRpZHM6IEpTT04uc3RyaW5naWZ5KF90aGlzLml0ZW1zKSxcblx0XHRcdFx0XHRfdG9rZW46ICQoJ21ldGFbbmFtZT1cImNzcmYtdG9rZW5cIl0nKS5hdHRyKCdjb250ZW50Jylcblx0XHRcdFx0fTtcblx0XHRcdFx0XG5cdFx0XHRcdCQucG9zdCgnL2FkbWluL2ZpZWxkcy9zaW1wbGUtc2F2ZScsIGRhdGEsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cdFx0XHRcdFx0aWYgKHJlc3BvbnNlLnN0YXR1cykge1xuXHRcdFx0XHRcdFx0JCgnaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdOmNoZWNrZWQnKS50cmlnZ2VyKCdjbGljaycpO1xuXG5cdFx0XHRcdFx0XHR0b2FzdHIuc3VjY2VzcygnVGhlIGZpZWxkcyBoYXZlIGJlZW4gc2F2ZWQuJyk7XG5cblx0XHRcdFx0XHRcdHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0dG9hc3RyLmVycm9yKCdDb3VsZCBub3Qgc2F2ZSBmaWVsZHMsIHBsZWFzZSB0cnkgYWdhaW4uJyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xufVxuXG5pZiAoJCgnLnVpLmZvcm0uZmllbGRzJykubGVuZ3RoKSB7XG5cdG5ldyBWdWUoe1xuXHRcdGVsOiAnLnVpLmZvcm0uZmllbGRzJyxcblx0XHRkYXRhOiB7XG5cdFx0XHRuYW1lOiAnJyxcblx0XHRcdGNhcHRpb246ICcnLFxuXHRcdFx0ZmllbGRfdHlwZTogJydcblx0XHR9LFxuXHRcdG1ldGhvZHM6IHtcblx0XHRcdHVwZGF0ZUNhcHRpb246IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0aGlzLmNhcHRpb24gPSBTKHRoaXMubmFtZSkuaHVtYW5pemUoKS5zO1xuXHRcdFx0fVxuXHRcdH1cblx0fSk7XG59XG5cbmlmICgkKFwiLnNvcnRhYmxlLmZpZWxkc1wiKS5sZW5ndGgpIHtcblx0JChcIi5zb3J0YWJsZS5maWVsZHNcIikuc29ydGFibGUoe1xuXHRcdG9uRHJvcDogZnVuY3Rpb24oJGl0ZW0sIGNvbnRhaW5lciwgX3N1cGVyLCBldmVudCkge1xuXHRcdFx0JGl0ZW0ucmVtb3ZlQ2xhc3MoY29udGFpbmVyLmdyb3VwLm9wdGlvbnMuZHJhZ2dlZENsYXNzKS5yZW1vdmVBdHRyKFwic3R5bGVcIik7XG5cdFx0XHQkKFwiYm9keVwiKS5yZW1vdmVDbGFzcyhjb250YWluZXIuZ3JvdXAub3B0aW9ucy5ib2R5Q2xhc3MpO1xuXG5cdFx0XHR2YXIgaXRlbXMgPSBbXTtcblx0XHRcdCQuZWFjaCgkKCcuc29ydGFibGUgbGknKSwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGl0ZW1zLnB1c2goJCh0aGlzKS5hdHRyKCdkYXRhLWlkJykpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHZhciBkYXRhID0ge1xuXHRcdFx0XHRpdGVtczogSlNPTi5zdHJpbmdpZnkoaXRlbXMpLFxuXHRcdFx0XHRfdG9rZW46ICQoJ21ldGFbbmFtZT1cImNzcmYtdG9rZW5cIl0nKS5hdHRyKCdjb250ZW50Jylcblx0XHRcdH07XG5cblx0XHRcdCQucG9zdCgnL2FkbWluL2ZpZWxkcy9vcmRlcicsIGRhdGEsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cdFx0XHRcdHRvYXN0ci5zdWNjZXMoJ09yZGVyIGhhcyBiZWVuIHNhdmVkLicpO1xuXHRcdFx0fSwgJ2pzb24nKTtcblx0XHR9XG5cdH0pO1xufVxuIiwiLy8gaW5kZXhcbmlmICgkKCcudWkuZmlsZXMuc2VhcmNoJykubGVuZ3RoKSB7XG5cdCQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuXHRcdCQoJy51aS5maWxlcy5zZWFyY2gnKS5zZWFyY2goe1xuXHRcdFx0YXBpU2V0dGluZ3M6IHtcblx0XHRcdFx0dXJsOiAnL2FkbWluL2FwaS9maWxlcz9rZXl3b3JkPXtxdWVyeX0nXG5cdFx0XHR9LFxuXHRcdFx0ZmllbGRzOiB7XG5cdFx0XHRcdHJlc3VsdHMgOiAncmVzdWx0cycsXG5cdFx0XHRcdHRpdGxlICAgOiAnZmlsZW5hbWUnLFxuXHRcdFx0XHR1cmwgICAgIDogJ3VybCdcblx0XHRcdH0sXG5cdFx0XHRtaW5DaGFyYWN0ZXJzIDogM1xuXHRcdH0pO1xuXHR9KTtcblxuXHR2YXIgQWRtaW5GaWxlc0luZGV4ID0gbmV3IFZ1ZSh7XG5cdFx0ZWw6ICd0YWJsZS5maWxlcycsXG5cdFx0ZGF0YToge1xuXHRcdFx0aXRlbXM6IFtdXG5cdFx0fSxcblx0XHRyZWFkeTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgX3RoaXMgPSB0aGlzO1xuXHRcdFx0JCgnLnVpLmNoZWNrYm94JykuY2hlY2tib3goe1xuXHRcdFx0XHRvbkNoYW5nZTogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0dmFyIGl0ZW1zID0gW107XG5cblx0XHRcdFx0XHQkLmVhY2goJCgnaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdOmNoZWNrZWQnKSwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRpdGVtcy5wdXNoKCQodGhpcykuYXR0cignZGF0YS1pZCcpKTtcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdF90aGlzLml0ZW1zID0gaXRlbXM7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0sXG5cdFx0bWV0aG9kczoge1xuXHRcdFx0ZGVsZXRlTWFueTogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGlmIChjb25maXJtKCdBcmUgeW91IHN1cmUgeW91IHdpc2ggdG8gZGVsZXRlPycpKSB7XG5cdFx0XHRcdFx0dmFyIF90aGlzID0gdGhpcztcblx0XHRcdFx0XHR2YXIgZGF0YSA9IHtcblx0XHRcdFx0XHRcdHR5cGU6ICdkZWxldGUnLFxuXHRcdFx0XHRcdFx0bWFueTogdHJ1ZSxcblx0XHRcdFx0XHRcdGlkczogSlNPTi5zdHJpbmdpZnkoX3RoaXMuaXRlbXMpLFxuXHRcdFx0XHRcdFx0X3Rva2VuOiAkKCdtZXRhW25hbWU9XCJjc3JmLXRva2VuXCJdJykuYXR0cignY29udGVudCcpXG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHQkLnBvc3QoJy9hZG1pbi9maWxlcy9zaW1wbGUtc2F2ZScsIGRhdGEsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cdFx0XHRcdFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzKSB7XG5cdFx0XHRcdFx0XHRcdF90aGlzLml0ZW1zID0gW107XG5cblx0XHRcdFx0XHRcdFx0dG9hc3RyLnN1Y2Nlc3MoJ1RoZSBmaWxlcyBoYXZlIGJlZW4gZGVsZXRlZC4nKTtcblxuXHRcdFx0XHRcdFx0XHR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHR0b2FzdHIuZXJyb3IoJ0NvdWxkIG5vdCBkZWxldGUgZmlsZXMsIHBsZWFzZSB0cnkgYWdhaW4uJyk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH0pO1xufVxuIiwiLy8gaW5kZXhcbmlmICgkKCcudWkucGFnZXMuc2VhcmNoJykubGVuZ3RoKSB7XG5cdCQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuXHRcdCQoJy51aS5wYWdlcy5zZWFyY2gnKVxuXHRcdC5zZWFyY2goe1xuXHRcdFx0YXBpU2V0dGluZ3M6IHtcblx0XHRcdFx0dXJsOiAnL2FkbWluL2FwaS9wYWdlcz9rZXl3b3JkPXtxdWVyeX0nXG5cdFx0XHR9LFxuXHRcdFx0ZmllbGRzOiB7XG5cdFx0XHRcdHJlc3VsdHMgOiAncmVzdWx0cycsXG5cdFx0XHRcdHRpdGxlICAgOiAnbmFtZScsXG5cdFx0XHRcdHVybCAgICAgOiAndXJsJ1xuXHRcdFx0fSxcblx0XHRcdG1pbkNoYXJhY3RlcnMgOiAzXG5cdFx0fSk7XG5cdH0pO1xuXG5cdHZhciBBZG1pblBhZ2VzSW5kZXggPSBuZXcgVnVlKHtcblx0XHRlbDogJ3RhYmxlLnBhZ2VzJyxcblx0XHRkYXRhOiB7XG5cdFx0XHRpdGVtczogW11cblx0XHR9LFxuXHRcdHJlYWR5OiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBfdGhpcyA9IHRoaXM7XG5cdFx0XHQkKCcudWkuY2hlY2tib3gnKS5jaGVja2JveCh7XG5cdFx0XHRcdG9uQ2hhbmdlOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHR2YXIgaXRlbXMgPSBbXTtcblxuXHRcdFx0XHRcdCQuZWFjaCgkKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl06Y2hlY2tlZCcpLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdGl0ZW1zLnB1c2goJCh0aGlzKS5hdHRyKCdkYXRhLWlkJykpO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0X3RoaXMuaXRlbXMgPSBpdGVtcztcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSxcblx0XHRtZXRob2RzOiB7XG5cdFx0XHRkZWxldGVNYW55OiBmdW5jdGlvbigpIHtcblx0XHRcdFx0aWYgKGNvbmZpcm0oJ0FyZSB5b3Ugc3VyZSB5b3Ugd2lzaCB0byBkZWxldGU/JykpIHtcblx0XHRcdFx0XHR2YXIgX3RoaXMgPSB0aGlzO1xuXHRcdFx0XHRcdHZhciBkYXRhID0ge1xuXHRcdFx0XHRcdFx0dHlwZTogJ2RlbGV0ZScsXG5cdFx0XHRcdFx0XHRtYW55OiB0cnVlLFxuXHRcdFx0XHRcdFx0aWRzOiBKU09OLnN0cmluZ2lmeShfdGhpcy5pdGVtcyksXG5cdFx0XHRcdFx0XHRfdG9rZW46ICQoJ21ldGFbbmFtZT1cImNzcmYtdG9rZW5cIl0nKS5hdHRyKCdjb250ZW50Jylcblx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdCQucG9zdCgnL2FkbWluL3BhZ2VzL3NpbXBsZS1zYXZlJywgZGF0YSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMpIHtcblx0XHRcdFx0XHRcdFx0X3RoaXMuaXRlbXMgPSBbXTtcblxuXHRcdFx0XHRcdFx0XHR0b2FzdHIuc3VjY2VzcygnVGhlIHBhZ2VzIGhhdmUgYmVlbiBkZWxldGVkLicpO1xuXG5cdFx0XHRcdFx0XHRcdHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHRvYXN0ci5lcnJvcignQ291bGQgbm90IGRlbGV0ZSBwYWdlcywgcGxlYXNlIHRyeSBhZ2Fpbi4nKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSxcblx0XHRcdHRvZ2dsZVN0YXR1c2VzTWFueTogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHZhciBfdGhpcyA9IHRoaXM7XG5cdFx0XHRcdHZhciBkYXRhID0ge1xuXHRcdFx0XHRcdHR5cGU6ICd0b2dnbGUtc3RhdHVzZXMnLFxuXHRcdFx0XHRcdG1hbnk6IHRydWUsXG5cdFx0XHRcdFx0aWRzOiBKU09OLnN0cmluZ2lmeShfdGhpcy5pdGVtcyksXG5cdFx0XHRcdFx0X3Rva2VuOiAkKCdtZXRhW25hbWU9XCJjc3JmLXRva2VuXCJdJykuYXR0cignY29udGVudCcpXG5cdFx0XHRcdH07XG5cdFx0XHRcdFxuXHRcdFx0XHQkLnBvc3QoJy9hZG1pbi9wYWdlcy9zaW1wbGUtc2F2ZScsIGRhdGEsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cdFx0XHRcdFx0aWYgKHJlc3BvbnNlLnN0YXR1cykge1xuXHRcdFx0XHRcdFx0JCgnaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdOmNoZWNrZWQnKS50cmlnZ2VyKCdjbGljaycpO1xuXG5cdFx0XHRcdFx0XHR0b2FzdHIuc3VjY2VzcygnVGhlIHBhZ2VzIGhhdmUgYmVlbiBzYXZlZC4nKTtcblxuXHRcdFx0XHRcdFx0d2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR0b2FzdHIuZXJyb3IoJ0NvdWxkIG5vdCBzYXZlIHBhZ2VzLCBwbGVhc2UgdHJ5IGFnYWluLicpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcbn1cblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG5cdGlmICgkKCcudWkuZm9ybS5wYWdlcycpLmxlbmd0aCkge1xuXHRcdG5ldyBWdWUoe1xuXHRcdFx0ZWw6ICcudWkuZm9ybS5wYWdlcycsXG5cdFx0XHRkYXRhOiB7XG5cdFx0XHRcdG5hbWU6ICcnLFxuXHRcdFx0XHRzbHVnOiAnJyxcblx0XHRcdFx0aW5pdFJhbjogZmFsc2Vcblx0XHRcdH0sXG5cdFx0XHR3YXRjaDoge1xuXHRcdFx0XHRuYW1lOiBmdW5jdGlvbihuZXdWYWwpIHtcblx0XHRcdFx0XHRpZiAodGhpcy5pbml0UmFuKSB7XG5cdFx0XHRcdFx0XHR0aGlzLnNsdWcgPSBzbHVnaWZ5KG5ld1ZhbCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCF0aGlzLmluaXRSYW4pIHtcblx0XHRcdFx0XHRcdHRoaXMuaW5pdFJhbiA9IHRydWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cbn0pO1xuXG5pZiAoJChcIi5zb3J0YWJsZS5wYWdlc1wiKS5sZW5ndGgpIHtcblx0JChcIi5zb3J0YWJsZS5wYWdlc1wiKS5zb3J0YWJsZSh7XG5cdFx0b25Ecm9wOiBmdW5jdGlvbigkaXRlbSwgY29udGFpbmVyLCBfc3VwZXIsIGV2ZW50KSB7XG5cdFx0XHQkaXRlbS5yZW1vdmVDbGFzcyhjb250YWluZXIuZ3JvdXAub3B0aW9ucy5kcmFnZ2VkQ2xhc3MpLnJlbW92ZUF0dHIoXCJzdHlsZVwiKTtcblx0XHRcdCQoXCJib2R5XCIpLnJlbW92ZUNsYXNzKGNvbnRhaW5lci5ncm91cC5vcHRpb25zLmJvZHlDbGFzcyk7XG5cblx0XHRcdHZhciBpdGVtcyA9IFtdO1xuXHRcdFx0JC5lYWNoKCQoJy5zb3J0YWJsZSBsaScpLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0aXRlbXMucHVzaCgkKHRoaXMpLmF0dHIoJ2RhdGEtaWQnKSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0dmFyIGRhdGEgPSB7XG5cdFx0XHRcdGl0ZW1zOiBKU09OLnN0cmluZ2lmeShpdGVtcyksXG5cdFx0XHRcdF90b2tlbjogJCgnbWV0YVtuYW1lPVwiY3NyZi10b2tlblwiXScpLmF0dHIoJ2NvbnRlbnQnKVxuXHRcdFx0fTtcblxuXHRcdFx0JC5wb3N0KCcvYWRtaW4vcGFnZXMvb3JkZXInLCBkYXRhLCBmdW5jdGlvbihyZXNwb25zZSkge1xuXHRcdFx0XHR0b2FzdHIuc3VjY2VzcygnT3JkZXIgaGFzIGJlZW4gc2F2ZWQuJyk7XG5cdFx0XHR9LCAnanNvbicpO1xuXHRcdH1cblx0fSk7XG59XG4iLCIvLyBpbmRleFxuaWYgKCQoJy51aS5wb3N0cy5zZWFyY2gnKS5sZW5ndGgpIHtcblx0JChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG5cdFx0JCgnLnVpLnBvc3RzLnNlYXJjaCcpLnNlYXJjaCh7XG5cdFx0XHRhcGlTZXR0aW5nczoge1xuXHRcdFx0XHR1cmw6ICcvYWRtaW4vYXBpL3Bvc3RzP2tleXdvcmQ9e3F1ZXJ5fSdcblx0XHRcdH0sXG5cdFx0XHRmaWVsZHM6IHtcblx0XHRcdFx0cmVzdWx0cyA6ICdyZXN1bHRzJyxcblx0XHRcdFx0dGl0bGUgICA6ICduYW1lJyxcblx0XHRcdFx0dXJsICAgICA6ICd1cmwnXG5cdFx0XHR9LFxuXHRcdFx0bWluQ2hhcmFjdGVycyA6IDNcblx0XHR9KTtcblx0fSk7XG5cblx0dmFyIEFkbWluUG9zdHNJbmRleCA9IG5ldyBWdWUoe1xuXHRcdGVsOiAndGFibGUucG9zdHMnLFxuXHRcdGRhdGE6IHtcblx0XHRcdGl0ZW1zOiBbXVxuXHRcdH0sXG5cdFx0cmVhZHk6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIF90aGlzID0gdGhpcztcblx0XHRcdCQoJy51aS5jaGVja2JveCcpLmNoZWNrYm94KHtcblx0XHRcdFx0b25DaGFuZ2U6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHZhciBpdGVtcyA9IFtdO1xuXG5cdFx0XHRcdFx0JC5lYWNoKCQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXTpjaGVja2VkJyksIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0aXRlbXMucHVzaCgkKHRoaXMpLmF0dHIoJ2RhdGEtaWQnKSk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRfdGhpcy5pdGVtcyA9IGl0ZW1zO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9LFxuXHRcdG1ldGhvZHM6IHtcblx0XHRcdGRlbGV0ZU1hbnk6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRpZiAoY29uZmlybSgnQXJlIHlvdSBzdXJlIHlvdSB3aXNoIHRvIGRlbGV0ZT8nKSkge1xuXHRcdFx0XHRcdHZhciBfdGhpcyA9IHRoaXM7XG5cdFx0XHRcdFx0dmFyIGRhdGEgPSB7XG5cdFx0XHRcdFx0XHR0eXBlOiAnZGVsZXRlJyxcblx0XHRcdFx0XHRcdG1hbnk6IHRydWUsXG5cdFx0XHRcdFx0XHRpZHM6IEpTT04uc3RyaW5naWZ5KF90aGlzLml0ZW1zKSxcblx0XHRcdFx0XHRcdF90b2tlbjogJCgnbWV0YVtuYW1lPVwiY3NyZi10b2tlblwiXScpLmF0dHIoJ2NvbnRlbnQnKVxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0JC5wb3N0KCcvYWRtaW4vcG9zdHMvc2ltcGxlLXNhdmUnLCBkYXRhLCBmdW5jdGlvbihyZXNwb25zZSkge1xuXHRcdFx0XHRcdFx0aWYgKHJlc3BvbnNlLnN0YXR1cykge1xuXHRcdFx0XHRcdFx0XHRfdGhpcy5pdGVtcyA9IFtdO1xuXG5cdFx0XHRcdFx0XHRcdHRvYXN0ci5zdWNjZXNzKCdUaGUgcG9zdHMgaGF2ZSBiZWVuIGRlbGV0ZWQuJyk7XG5cblx0XHRcdFx0XHRcdFx0d2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0dG9hc3RyLmVycm9yKCdDb3VsZCBub3QgZGVsZXRlIHBvc3RzLCBwbGVhc2UgdHJ5IGFnYWluLicpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXHRcdFx0dG9nZ2xlU3RhdHVzZXNNYW55OiBmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIF90aGlzID0gdGhpcztcblx0XHRcdFx0dmFyIGRhdGEgPSB7XG5cdFx0XHRcdFx0dHlwZTogJ3RvZ2dsZS1zdGF0dXNlcycsXG5cdFx0XHRcdFx0bWFueTogdHJ1ZSxcblx0XHRcdFx0XHRpZHM6IEpTT04uc3RyaW5naWZ5KF90aGlzLml0ZW1zKSxcblx0XHRcdFx0XHRfdG9rZW46ICQoJ21ldGFbbmFtZT1cImNzcmYtdG9rZW5cIl0nKS5hdHRyKCdjb250ZW50Jylcblx0XHRcdFx0fTtcblx0XHRcdFx0XG5cdFx0XHRcdCQucG9zdCgnL2FkbWluL3Bvc3RzL3NpbXBsZS1zYXZlJywgZGF0YSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzKSB7XG5cdFx0XHRcdFx0XHQkKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl06Y2hlY2tlZCcpLnRyaWdnZXIoJ2NsaWNrJyk7XG5cblx0XHRcdFx0XHRcdHRvYXN0ci5zdWNjZXNzKCdUaGUgcG9zdHMgaGF2ZSBiZWVuIHNhdmVkLicpO1xuXG5cdFx0XHRcdFx0XHR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHRvYXN0ci5lcnJvcignQ291bGQgbm90IHNhdmUgcG9zdHMsIHBsZWFzZSB0cnkgYWdhaW4uJyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xufVxuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcblx0aWYgKCQoJy51aS5mb3JtLnBvc3RzJykubGVuZ3RoKSB7XG5cdFx0bmV3IFZ1ZSh7XG5cdFx0XHRlbDogJy51aS5mb3JtLnBvc3RzJyxcblx0XHRcdGRhdGE6IHtcblx0XHRcdFx0bmFtZTogJycsXG5cdFx0XHRcdHNsdWc6ICcnLFxuXHRcdFx0XHRpbml0UmFuOiBmYWxzZVxuXHRcdFx0fSxcblx0XHRcdHdhdGNoOiB7XG5cdFx0XHRcdG5hbWU6IGZ1bmN0aW9uKG5ld1ZhbCkge1xuXHRcdFx0XHRcdGlmICh0aGlzLmluaXRSYW4pIHtcblx0XHRcdFx0XHRcdHRoaXMuc2x1ZyA9IHNsdWdpZnkobmV3VmFsKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIXRoaXMuaW5pdFJhbikge1xuXHRcdFx0XHRcdFx0dGhpcy5pbml0UmFuID0gdHJ1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblx0fVxufSk7XG5cbi8vIGFkZC9lZGl0XG5pZiAoJCgnI0FkbWluQXJ0aWNsZXNBcHAnKS5sZW5ndGgpIHtcblx0dmFyIEFkbWluQXJ0aWNsZXNBcHAgPSBuZXcgVnVlKHtcblx0XHRlbDogJyNBZG1pbkFydGljbGVzQXBwJyxcblx0XHRjcmVhdGVkOiBmdW5jdGlvbigpIHtcblxuXHRcdH1cblx0fSk7XG5cblx0aWYgKCQoJyNkYXRlcGlja2VyJykubGVudGgpIHtcblx0XHRuZXcgRGF0ZVBpY2tlcih7IGRhdGFGaWVsZHM6IFtkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0ZXBpY2tlcicpXSB9KTtcblx0fVxufVxuIiwiaWYgKCQoJ2Rpdi5zZXR0aW5ncycpLmxlbmd0aCkge1xuICAgIG5ldyBWdWUoe1xuXHRcdGVsOiAnZGl2LnNldHRpbmdzJyxcblx0XHRkYXRhOiB7XG5cdFx0ICAgIGl0ZW1zOiBbXVxuXHRcdH0sXG5cdFx0cmVhZHk6IGZ1bmN0aW9uKCkge1xuXHRcdCAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXHRcdCAgICAkKCcudWkuY2hlY2tib3gnKS5jaGVja2JveCh7XG5cdFx0XHRcdG9uQ2hhbmdlOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0ICAgIHZhciBpdGVtcyA9IFtdO1xuXHRcdFxuXHRcdFx0XHQgICAgJC5lYWNoKCQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXTpjaGVja2VkJyksIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0aXRlbXMucHVzaCgkKHRoaXMpLmF0dHIoJ2RhdGEtaWQnKSk7XG5cdFx0XHRcdCAgICB9KTtcblx0XHRcblx0XHRcdFx0ICAgIF90aGlzLml0ZW1zID0gaXRlbXM7XG5cdFx0XHRcdH1cblx0XHQgICAgfSk7XG5cdFx0fSxcblx0XHRtZXRob2RzOiB7XG5cdFx0ICAgIHNhdmVTZXR0aW5nczogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHZhciBfdGhpcyA9IHRoaXM7XG5cdFx0XHRcdHZhciBzZXR0aW5ncyA9IFtdO1xuXHRcdFxuXHRcdFx0XHQkLmVhY2goJCgnLnNldHRpbmcnKSwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdCAgICBzZXR0aW5ncy5wdXNoKHtcblx0XHRcdFx0XHRrZXk6ICQodGhpcykuYXR0cignZGF0YS1rZXknKSxcblx0XHRcdFx0XHR2YWx1ZTogJCh0aGlzKS52YWwoKVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KTtcblx0XG5cdFx0XHRcdHZhciBkYXRhID0geyBcblx0XHRcdFx0XHR0eXBlOiAnc2F2ZScsIFxuXHRcdFx0XHRcdG1hbnk6IHRydWUsIFxuXHRcdFx0XHRcdGRhdGE6IHNldHRpbmdzLCBcblx0XHRcdFx0XHRfdG9rZW46ICQoJ21ldGFbbmFtZT1cImNzcmYtdG9rZW5cIl0nKS5hdHRyKCdjb250ZW50Jylcblx0XHRcdFx0fTtcblx0XHRcblx0XHRcdFx0JC5wb3N0KCcvYWRtaW4vc2V0dGluZ3Mvc2ltcGxlLXNhdmUnLCBkYXRhLCBmdW5jdGlvbihyZXNwb25zZSkge1xuXHRcdFx0XHQgICAgaWYgKHJlc3BvbnNlLnN0YXR1cykge1xuXHRcdFx0XHRcdFx0dG9hc3RyLnN1Y2Nlc3MoJ1RoZSBzZXR0aW5ncyBoYXZlIGJlZW4gc2F2ZWQuJyk7XG5cdFx0XHRcdCAgICB9IGVsc2Uge1xuXHRcdFx0XHRcdFx0dG9hc3RyLmVycm9yKCdDb3VsZCBub3Qgc2F2ZSBzZXR0aW5ncywgcGxlYXNlIHRyeSBhZ2Fpbi4nKTtcblx0XHRcdFx0ICAgIH1cblx0XHRcdFx0fSk7XG5cdFx0ICAgIH0sXG5cdFx0ICAgIGRlbGV0ZU1hbnk6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRpZiAoY29uZmlybSgnQXJlIHlvdSBzdXJlIHlvdSB3aXNoIHRvIGRlbGV0ZT8nKSkge1xuXHRcdFx0XHQgICAgdmFyIF90aGlzID0gdGhpcztcblx0XHRcdFx0XHR2YXIgZGF0YSA9IHtcblx0XHRcdFx0XHRcdHR5cGU6ICdkZWxldGUnLFxuXHRcdFx0XHRcdFx0bWFueTogdHJ1ZSxcblx0XHRcdFx0XHRcdGlkczogSlNPTi5zdHJpbmdpZnkoX3RoaXMuaXRlbXMpLFxuXHRcdFx0XHRcdFx0X3Rva2VuOiAkKCdtZXRhW25hbWU9XCJjc3JmLXRva2VuXCJdJykuYXR0cignY29udGVudCcpXG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcblx0XHRcdFx0ICAgICQucG9zdCgnL2FkbWluL3NldHRpbmdzL3NpbXBsZS1zYXZlJywgZGF0YSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMpIHtcblx0XHRcdFx0XHRcdCAgICBfdGhpcy5pdGVtcyA9IFtdO1xuXHRcdFx0XG5cdFx0XHRcdFx0XHQgICAgdG9hc3RyLnN1Y2Nlc3MoJ1RoZSBzZXR0aW5ncyBoYXZlIGJlZW4gZGVsZXRlZC4nKTtcblxuXHRcdFx0XHRcdFx0ICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHQgICAgdG9hc3RyLmVycm9yKCdDb3VsZCBub3QgZGVsZXRlIHNldHRpbmdzLCBwbGVhc2UgdHJ5IGFnYWluLicpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHQgICAgfSk7XG5cdFx0XHRcdH1cblx0XHQgICAgfVxuXHRcdH1cbiAgICB9KTtcbn1cbiIsIi8vIGluZGV4XG5pZiAoJCgnLnVpLnRhZ3Muc2VhcmNoJykubGVuZ3RoKSB7XG5cdCQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuXHRcdCQoJy51aS50YWdzLnNlYXJjaCcpLnNlYXJjaCh7XG5cdFx0XHRhcGlTZXR0aW5nczoge1xuXHRcdFx0XHR1cmw6ICcvYWRtaW4vYXBpL3RhZ3M/a2V5d29yZD17cXVlcnl9J1xuXHRcdFx0fSxcblx0XHRcdGZpZWxkczoge1xuXHRcdFx0XHRyZXN1bHRzIDogJ3Jlc3VsdHMnLFxuXHRcdFx0XHR0aXRsZSAgIDogJ25hbWUnLFxuXHRcdFx0XHR1cmwgICAgIDogJ3VybCdcblx0XHRcdH0sXG5cdFx0XHRtaW5DaGFyYWN0ZXJzIDogM1xuXHRcdH0pO1xuXHR9KTtcblxuXHR2YXIgQWRtaW5UYWdzSW5kZXggPSBuZXcgVnVlKHtcblx0XHRlbDogJ3RhYmxlLnRhZ3MnLFxuXHRcdGRhdGE6IHtcblx0XHRcdGl0ZW1zOiBbXVxuXHRcdH0sXG5cdFx0cmVhZHk6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIF90aGlzID0gdGhpcztcblx0XHRcdCQoJy51aS5jaGVja2JveCcpLmNoZWNrYm94KHtcblx0XHRcdFx0b25DaGFuZ2U6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHZhciBpdGVtcyA9IFtdO1xuXG5cdFx0XHRcdFx0JC5lYWNoKCQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXTpjaGVja2VkJyksIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0aXRlbXMucHVzaCgkKHRoaXMpLmF0dHIoJ2RhdGEtaWQnKSk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRfdGhpcy5pdGVtcyA9IGl0ZW1zO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9LFxuXHRcdG1ldGhvZHM6IHtcblx0XHRcdGRlbGV0ZU1hbnk6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRpZiAoY29uZmlybSgnQXJlIHlvdSBzdXJlIHlvdSB3aXNoIHRvIGRlbGV0ZT8nKSkge1xuXHRcdFx0XHRcdHZhciBfdGhpcyA9IHRoaXM7XG5cdFx0XHRcdFx0dmFyIGRhdGEgPSB7XG5cdFx0XHRcdFx0XHR0eXBlOiAnZGVsZXRlJyxcblx0XHRcdFx0XHRcdG1hbnk6IHRydWUsXG5cdFx0XHRcdFx0XHRpZHM6IEpTT04uc3RyaW5naWZ5KF90aGlzLml0ZW1zKSxcblx0XHRcdFx0XHRcdF90b2tlbjogJCgnbWV0YVtuYW1lPVwiY3NyZi10b2tlblwiXScpLmF0dHIoJ2NvbnRlbnQnKVxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0JC5wb3N0KCcvYWRtaW4vdGFncy9zaW1wbGUtc2F2ZScsIGRhdGEsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cdFx0XHRcdFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzKSB7XG5cdFx0XHRcdFx0XHRcdF90aGlzLml0ZW1zID0gW107XG5cblx0XHRcdFx0XHRcdFx0dG9hc3RyLnN1Y2Nlc3MoJ1RoZSB0YWdzIGhhdmUgYmVlbiBkZWxldGVkLicpO1xuXG5cdFx0XHRcdFx0XHRcdHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHRvYXN0ci5lcnJvcignQ291bGQgbm90IGRlbGV0ZSB0YWdzLCBwbGVhc2UgdHJ5IGFnYWluLicpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXHRcdFx0dG9nZ2xlU3RhdHVzZXNNYW55OiBmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyIF90aGlzID0gdGhpcztcblx0XHRcdFx0dmFyIGRhdGEgPSB7XG5cdFx0XHRcdFx0dHlwZTogJ3RvZ2dsZS1zdGF0dXNlcycsXG5cdFx0XHRcdFx0bWFueTogdHJ1ZSxcblx0XHRcdFx0XHRpZHM6IEpTT04uc3RyaW5naWZ5KF90aGlzLml0ZW1zKSxcblx0XHRcdFx0XHRfdG9rZW46ICQoJ21ldGFbbmFtZT1cImNzcmYtdG9rZW5cIl0nKS5hdHRyKCdjb250ZW50Jylcblx0XHRcdFx0fTtcblx0XHRcdFx0XG5cdFx0XHRcdCQucG9zdCgnL2FkbWluL3RhZ3Mvc2ltcGxlLXNhdmUnLCBkYXRhLCBmdW5jdGlvbihyZXNwb25zZSkge1xuXHRcdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMpIHtcblx0XHRcdFx0XHRcdCQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXTpjaGVja2VkJykudHJpZ2dlcignY2xpY2snKTtcblxuXHRcdFx0XHRcdFx0dG9hc3RyLnN1Y2Nlc3MoJ1RoZSB0YWdzIGhhdmUgYmVlbiBzYXZlZC4nKTtcblxuXHRcdFx0XHRcdFx0d2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR0b2FzdHIuZXJyb3IoJ0NvdWxkIG5vdCBzYXZlIHRhZ3MsIHBsZWFzZSB0cnkgYWdhaW4uJyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xufVxuIiwiLy8gaW5kZXhcbmlmICgkKCd0YWJsZS50aGVtZXMnKS5sZW5ndGgpIHtcblx0dmFyIEFkbWluVGhlbWVzSW5kZXggPSBuZXcgVnVlKHtcblx0XHRlbDogJ3RhYmxlLnRoZW1lcycsXG5cdFx0ZGF0YToge1xuXHRcdFx0aXRlbXM6IFtdXG5cdFx0fSxcblx0XHRyZWFkeTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgX3RoaXMgPSB0aGlzO1xuXHRcdFx0JCgnLnVpLmNoZWNrYm94JykuY2hlY2tib3goe1xuXHRcdFx0XHRvbkNoYW5nZTogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0dmFyIGl0ZW1zID0gW107XG5cblx0XHRcdFx0XHQkLmVhY2goJCgnaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdOmNoZWNrZWQnKSwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRpdGVtcy5wdXNoKCQodGhpcykuYXR0cignZGF0YS1pZCcpKTtcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdF90aGlzLml0ZW1zID0gaXRlbXM7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0sXG5cdFx0bWV0aG9kczoge1xuXHRcdFx0ZGVsZXRlTWFueTogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGlmIChjb25maXJtKCdBcmUgeW91IHN1cmUgeW91IHdpc2ggdG8gZGVsZXRlPycpKSB7XG5cdFx0XHRcdFx0dmFyIF90aGlzID0gdGhpcztcblx0XHRcdFx0XHR2YXIgZGF0YSA9IHtcblx0XHRcdFx0XHRcdHR5cGU6ICdkZWxldGUnLFxuXHRcdFx0XHRcdFx0bWFueTogdHJ1ZSxcblx0XHRcdFx0XHRcdGlkczogSlNPTi5zdHJpbmdpZnkoX3RoaXMuaXRlbXMpLFxuXHRcdFx0XHRcdFx0X3Rva2VuOiAkKCdtZXRhW25hbWU9XCJjc3JmLXRva2VuXCJdJykuYXR0cignY29udGVudCcpXG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHQkLnBvc3QoJy9hZG1pbi90aGVtZXMvc2ltcGxlLXNhdmUnLCBkYXRhLCBmdW5jdGlvbihyZXNwb25zZSkge1xuXHRcdFx0XHRcdFx0aWYgKHJlc3BvbnNlLnN0YXR1cykge1xuXHRcdFx0XHRcdFx0XHRfdGhpcy5pdGVtcyA9IFtdO1xuXG5cdFx0XHRcdFx0XHRcdHRvYXN0ci5zdWNjZXNzKCdUaGUgdGhlbWVzIGhhdmUgYmVlbiBkZWxldGVkLicpO1xuXG5cdFx0XHRcdFx0XHRcdHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHRvYXN0ci5lcnJvcignQ291bGQgbm90IGRlbGV0ZSB0aGVtZXMsIHBsZWFzZSB0cnkgYWdhaW4uJyk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cdFx0XHR0b2dnbGVTdGF0dXNlc01hbnk6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR2YXIgX3RoaXMgPSB0aGlzO1xuXHRcdFx0XHR2YXIgZGF0YSA9IHtcblx0XHRcdFx0XHR0eXBlOiAndG9nZ2xlLXN0YXR1c2VzJyxcblx0XHRcdFx0XHRtYW55OiB0cnVlLFxuXHRcdFx0XHRcdGlkczogSlNPTi5zdHJpbmdpZnkoX3RoaXMuaXRlbXMpLFxuXHRcdFx0XHRcdF90b2tlbjogJCgnbWV0YVtuYW1lPVwiY3NyZi10b2tlblwiXScpLmF0dHIoJ2NvbnRlbnQnKVxuXHRcdFx0XHR9O1xuXHRcdFx0XHRcblx0XHRcdFx0JC5wb3N0KCcvYWRtaW4vdGhlbWVzL3NpbXBsZS1zYXZlJywgZGF0YSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzKSB7XG5cdFx0XHRcdFx0XHQkKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl06Y2hlY2tlZCcpLnRyaWdnZXIoJ2NsaWNrJyk7XG5cblx0XHRcdFx0XHRcdHRvYXN0ci5zdWNjZXNzKCdUaGUgdGhlbWVzIGhhdmUgYmVlbiBzYXZlZC4nKTtcblxuXHRcdFx0XHRcdFx0d2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR0b2FzdHIuZXJyb3IoJ0NvdWxkIG5vdCBzYXZlIHRoZW1lcywgcGxlYXNlIHRyeSBhZ2Fpbi4nKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fSk7XG59XG4iLCJ2YXIgbW9kdWxlVXBkYXRlcyA9IFtcbiAgICB7XG4gICAgICAgICduYW1lJzogJ1BsdWdpbicsXG4gICAgICAgICdzbHVnJzogJ3BsdWdpbidcbiAgICB9LFxuICAgIHtcbiAgICAgICAgJ25hbWUnOiAnVGhlbWUnLFxuICAgICAgICAnc2x1Zyc6ICd0aGVtZSdcbiAgICB9XG5dO1xuXG5fLmVhY2gobW9kdWxlVXBkYXRlcywgZnVuY3Rpb24obW9kdWxlKSB7XG4gICAgdmFyIHVwZGF0ZXNBcHAgPSAkKCcudWkudGFibGUuJyArIG1vZHVsZS5zbHVnICsgJ3MudXBkYXRlJyk7XG4gICAgaWYgKHVwZGF0ZXNBcHAubGVuZ3RoKSB7XG4gICAgICAgIG5ldyBWdWUoe1xuICAgICAgICAgICAgZWw6ICcudWkudGFibGUuJyArIG1vZHVsZS5zbHVnICsgJ3MudXBkYXRlJyxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBtb2R1bGVfaWRzOiB7fVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1ldGhvZHM6IHtcbiAgICAgICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIFx0dmFyIG1lc3NhZ2UgPSAnQXJlIHlvdSBzdXJlIHlvdSB3aXNoIHRvIHVwZGF0ZSB0aGVzZSAnICsgbW9kdWxlLnNsdWcgKyAnKHMpPyc7XG4gICAgICAgICAgICAgICAgXHRcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm0obWVzc2FnZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZV9pZHM6IHRoaXMubW9kdWxlX2lkcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdG9rZW46ICQoJ21ldGFbbmFtZT1cImNzcmYtdG9rZW5cIl0nKS5hdHRyKCdjb250ZW50JylcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICQucG9zdCgnL2FkbWluL3VwZGF0ZXMvdXBkYXRlLycgKyBtb2R1bGUuc2x1ZyArICdzJywgZGF0YSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKG1vZHVsZS5uYW1lICsgJyhzKSBoYXZlIGJlZW4gaW5zdGFsbGVkIScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcignQ291bGQgbm90IGluc3RhbGwsIHNvcnJ5IScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sICdqc29uJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHVwZGF0ZUFsbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICQuZWFjaCgkKG1vZHVsZS5zbHVnICsgJy1pZCcpLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuYXR0cignY2hlY2tlZCcsICdjaGVja2VkJyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgNTApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG4iLCIvLyBpbmRleFxuaWYgKCQoJy51aS51c2Vycy5zZWFyY2gnKS5sZW5ndGgpIHtcblx0JChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG5cdFx0JCgnLnVpLnVzZXJzLnNlYXJjaCcpLnNlYXJjaCh7XG5cdFx0XHRhcGlTZXR0aW5nczoge1xuXHRcdFx0XHR1cmw6ICcvYWRtaW4vYXBpL3VzZXJzP2tleXdvcmQ9e3F1ZXJ5fSdcblx0XHRcdH0sXG5cdFx0XHRmaWVsZHM6IHtcblx0XHRcdFx0cmVzdWx0cyA6ICdyZXN1bHRzJyxcblx0XHRcdFx0dGl0bGUgICA6ICd1c2VybmFtZScsXG5cdFx0XHRcdHVybCAgICAgOiAndXJsJ1xuXHRcdFx0fSxcblx0XHRcdG1pbkNoYXJhY3RlcnMgOiAzXG5cdFx0fSk7XG5cdH0pO1xuXG5cdHZhciBBZG1pblVzZXJzSW5kZXggPSBuZXcgVnVlKHtcblx0XHRlbDogJ3RhYmxlLnVzZXJzJyxcblx0XHRkYXRhOiB7XG5cdFx0XHRpdGVtczogW11cblx0XHR9LFxuXHRcdHJlYWR5OiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBfdGhpcyA9IHRoaXM7XG5cdFx0XHQkKCcudWkuY2hlY2tib3gnKS5jaGVja2JveCh7XG5cdFx0XHRcdG9uQ2hhbmdlOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHR2YXIgaXRlbXMgPSBbXTtcblxuXHRcdFx0XHRcdCQuZWFjaCgkKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl06Y2hlY2tlZCcpLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdGl0ZW1zLnB1c2goJCh0aGlzKS5hdHRyKCdkYXRhLWlkJykpO1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0X3RoaXMuaXRlbXMgPSBpdGVtcztcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSxcblx0XHRtZXRob2RzOiB7XG5cdFx0XHRkZWxldGVNYW55OiBmdW5jdGlvbigpIHtcblx0XHRcdFx0aWYgKGNvbmZpcm0oJ0FyZSB5b3Ugc3VyZSB5b3Ugd2lzaCB0byBkZWxldGU/JykpIHtcblx0XHRcdFx0XHR2YXIgX3RoaXMgPSB0aGlzO1xuXHRcdFx0XHRcdHZhciBkYXRhID0ge1xuXHRcdFx0XHRcdFx0dHlwZTogJ2RlbGV0ZScsXG5cdFx0XHRcdFx0XHRtYW55OiB0cnVlLFxuXHRcdFx0XHRcdFx0aWRzOiBKU09OLnN0cmluZ2lmeShfdGhpcy5pdGVtcyksXG5cdFx0XHRcdFx0XHRfdG9rZW46ICQoJ21ldGFbbmFtZT1cImNzcmYtdG9rZW5cIl0nKS5hdHRyKCdjb250ZW50Jylcblx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdCQucG9zdCgnL2FkbWluL3VzZXJzL3NpbXBsZS1zYXZlJywgZGF0YSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMpIHtcblx0XHRcdFx0XHRcdFx0X3RoaXMuaXRlbXMgPSBbXTtcblxuXHRcdFx0XHRcdFx0XHR0b2FzdHIuc3VjY2VzcygnVGhlIHVzZXJzIGhhdmUgYmVlbiBkZWxldGVkLicpO1xuXG5cdFx0XHRcdFx0XHRcdHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHRvYXN0ci5lcnJvcignQ291bGQgbm90IGRlbGV0ZSB1c2VycywgcGxlYXNlIHRyeSBhZ2Fpbi4nKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSxcblx0XHRcdHRvZ2dsZVN0YXR1c2VzTWFueTogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHZhciBfdGhpcyA9IHRoaXM7XG5cdFx0XHRcdHZhciBkYXRhID0ge1xuXHRcdFx0XHRcdHR5cGU6ICd0b2dnbGUtc3RhdHVzZXMnLFxuXHRcdFx0XHRcdG1hbnk6IHRydWUsXG5cdFx0XHRcdFx0aWRzOiBKU09OLnN0cmluZ2lmeShfdGhpcy5pdGVtcyksXG5cdFx0XHRcdFx0X3Rva2VuOiAkKCdtZXRhW25hbWU9XCJjc3JmLXRva2VuXCJdJykuYXR0cignY29udGVudCcpXG5cdFx0XHRcdH07XG5cdFx0XHRcdCQucG9zdCgnL2FkbWluL3VzZXJzL3NpbXBsZS1zYXZlJywgZGF0YSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzKSB7XG5cdFx0XHRcdFx0XHQkKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl06Y2hlY2tlZCcpLnRyaWdnZXIoJ2NsaWNrJyk7XG5cblx0XHRcdFx0XHRcdHRvYXN0ci5zdWNjZXNzKCdUaGUgdXNlcnMgaGF2ZSBiZWVuIHNhdmVkLicpO1xuXG5cdFx0XHRcdFx0XHR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHRvYXN0ci5lcnJvcignQ291bGQgbm90IHNhdmUgdXNlcnMsIHBsZWFzZSB0cnkgYWdhaW4uJyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xufVxuIiwiJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgaWYgKCQoJ2JvZHkuaW5zdGFsbC5kYXRhYmFzZScpLmxlbmd0aCkge1xuICAgICAgICBuZXcgVnVlKHtcbiAgICAgICAgICAgIGVsOiAnLnVpLnNlZ21lbnQnLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIGRhdGFiYXNlX2Nvbm5lY3Rpb246IGZhbHNlLFxuICAgICAgICAgICAgICAgIGZpbGxlZF9vdXQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICdEQl9IT1NUJzogJ2xvY2FsaG9zdCcsXG4gICAgICAgICAgICAgICAgJ0RCX1BPUlQnOiAnMzMwNicsXG4gICAgICAgICAgICAgICAgJ0RCX0RBVEFCQVNFJzogJycsXG4gICAgICAgICAgICAgICAgJ0RCX1VTRVJOQU1FJzogJ3Jvb3QnLFxuICAgICAgICAgICAgICAgICdEQl9QQVNTV09SRCc6ICcnLFxuICAgICAgICAgICAgICAgICdzaXRlbmFtZSc6ICcnLFxuICAgICAgICAgICAgICAgIGZpZWxkczogW1xuICAgICAgICAgICAgICAgICAgICAnREJfSE9TVCcsXG4gICAgICAgICAgICAgICAgICAgICdEQl9QT1JUJyxcbiAgICAgICAgICAgICAgICAgICAgJ0RCX0RBVEFCQVNFJyxcbiAgICAgICAgICAgICAgICAgICAgJ0RCX1VTRVJOQU1FJyxcbiAgICAgICAgICAgICAgICAgICAgJ0RCX1BBU1NXT1JEJ1xuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZXRob2RzOiB7XG4gICAgICAgICAgICAgICAgdGVzdENvbm5lY3Rpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge307XG4gICAgICAgICAgICAgICAgICAgIF8uZWFjaCh0aGlzLmZpZWxkcywgZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2tleV0gPSBfdGhpc1trZXldO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBkYXRhLl90b2tlbiA9ICQoJ21ldGFbbmFtZT1cImNzcmYtdG9rZW5cIl0nKS5hdHRyKCdjb250ZW50Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVEVNUE9SQVJZXG4gICAgICAgICAgICAgICAgICAgIC8vIGdvdHRhIHdyaXRlIGl0IGFuZCB0cnkgaXQgb24gdGhlIHNlY29uZCBhdHRlbXB0XG4gICAgICAgICAgICAgICAgICAgICQucG9zdCgnL2luc3RhbGwvZGF0YWJhc2UnLCBkYXRhLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQucG9zdCgnL2luc3RhbGwvZGF0YWJhc2UnLCBkYXRhLCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoJ0RhdGFiYXNlIGNvbm5lY3Rpb24gaXMgYS1nbyEnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoJ05vIGRpY2UhIFRyeSBhZ2FpbiBwbGVhc2UuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZGF0YWJhc2VfY29ubmVjdGlvbiA9IHJlc3BvbnNlLnN0YXR1cztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sICdqc29uJyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaXNGaWxsZWRPdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBmaWxsZWRfb3V0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgXy5lYWNoKHRoaXMuZmllbGRzLCBmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghX3RoaXNba2V5XS5sZW5ndGggJiYga2V5ICE9PSAnREJfUEFTU1dPUkQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbGVkX291dCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGxlZF9vdXQgPSBmaWxsZWRfb3V0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3YXRjaDoge1xuICAgICAgICAgICAgICAgIERCX0hPU1Q6IGZ1bmN0aW9uKG5ld1ZhbCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzRmlsbGVkT3V0KCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBEQl9QT1JUOiBmdW5jdGlvbihuZXdWYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0ZpbGxlZE91dCgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgREJfREFUQUJBU0U6IGZ1bmN0aW9uKG5ld1ZhbCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzRmlsbGVkT3V0KCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBEQl9VU0VSTkFNRTogZnVuY3Rpb24obmV3VmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNGaWxsZWRPdXQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfVxufSk7XG4iLCIkKGRvY3VtZW50KS5hamF4RXJyb3IoZnVuY3Rpb24oZXZlbnQsIGpxeGhyLCBzZXR0aW5ncywgdGhyb3duRXJyb3IpIHtcbiAgICB0b2FzdHIuZXJyb3IoJ1VoLW9oISBHb3QgYW4gZXJyb3IgZnJvbSB0aGUgc2VydmVyLiBGb3IgdGhlIGRldnMsIGl0IHdhcyBhIFwiJyArIHRocm93bkVycm9yICsgJ1wiIGVycm9yLCBzcGVjaWZpY2FsbHkuJyk7XG59KTtcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgaWYgKCQoJy51aS5kcm9wZG93bjpub3QoLmNtcyknKS5sZW5ndGgpIHtcbiAgICAgICAgJCgnLnVpLmRyb3Bkb3duOm5vdCguY21zKScpLmRyb3Bkb3duKHtcbiAgICAgICAgICAgIG9uOiAnaG92ZXInXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICgkKCcudWkuZHJvcGRvd24uY21zJykubGVuZ3RoKSB7XG4gICAgICAgICQoJy51aS5kcm9wZG93bi5jbXMnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICQodGhpcykuZmluZCgnLm1lbnUnKS50b2dnbGVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHZhciBjbG9zZU1lbnUgPSAkKCcudWkuY2xvc2UtbWVudScpO1xuICAgIGlmIChjbG9zZU1lbnUubGVuZ3RoKSB7XG4gICAgICAgIGNsb3NlTWVudS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICQoJ2JvZHknKS50cmlnZ2VyKCdjbGljaycpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBsZXQgcG9wdXBzID0gJCgnLmFjdGl2YXRlLnBvcHVwJylcbiAgICBpZiAocG9wdXBzLmxlbmd0aCkge1xuICAgICAgcG9wdXBzLnBvcHVwKHtcbiAgICAgICAgaW5saW5lOiB0cnVlLFxuICAgICAgICBob3ZlcmFibGU6IHRydWUsXG4gICAgICAgIGxhc3RSZXNvcnQ6IHRydWUsXG4gICAgICAgIHBvc2l0aW9uOiAncmlnaHQgY2VudGVyJ1xuICAgICAgfSlcbiAgICB9XG5cbiAgICAkKCcuYnRuLWNvbmZpcm0nKS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmIChjb25maXJtKCdBcmUgeW91IHN1cmUgeW91IHdpc2ggdG8gZGVsZXRlPycpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKCQoJy50YWdzSW5wdXQnKS5sZW5ndGgpIHtcbiAgICAgICAgJCgnLnRhZ3NJbnB1dCcpLnRhZ3NJbnB1dCgpO1xuICAgIH1cblxuICAgIGlmICgkKCdkaXYuY2FsZW5kYXInKS5sZW5ndGgpIHtcbiAgICAgICAgJCgnZGl2LmNhbGVuZGFyJykuY2FsZW5kYXIoe1xuICAgICAgICAgICAgdHlwZTogJ2RhdGUnLFxuICAgICAgICAgICAgcG9wdXBPcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246ICdyaWdodCBjZW50ZXInXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICgkKCcudGFicy5tZW51JykubGVuZ3RoKSB7XG4gICAgICAgICQoJy50YWJzLm1lbnUgLml0ZW0nKS50YWIoKTtcbiAgICB9XG5cbiAgICBpZiAoJCgnc2VsZWN0LmRyb3Bkb3duJykubGVuZ3RoKSB7XG4gICAgICAgICQoJ3NlbGVjdC5kcm9wZG93bicpLmRyb3Bkb3duKCk7XG4gICAgfVxuXG4gICAgdmFyIGRyb3Bkb3ducyA9ICQoJy51aS5kcm9wZG93bi5hbGxvd0FkZGl0aW9ucycpO1xuICAgIGlmIChkcm9wZG93bnMubGVuZ3RoKSB7XG4gICAgICAgIGRyb3Bkb3ducy5kcm9wZG93bih7XG4gICAgICAgICAgICBhbGxvd0FkZGl0aW9uczogdHJ1ZVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICB2YXIgbWVzc2FnZSA9ICQoJy51aS5tZXNzYWdlIC5jbG9zZScpO1xuICAgIGlmIChtZXNzYWdlLmxlbmd0aCkge1xuICAgICAgICBtZXNzYWdlLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbWVzc2FnZS50b2dnbGVDbGFzcygnaGlkZGVuJyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHZhciBtb2R1bGVzX3NlYXJjaCA9ICQoJy51aS5zZWFyY2gubW9kdWxlcycpO1xuICAgIGlmIChtb2R1bGVzX3NlYXJjaC5sZW5ndGgpIHtcbiAgICAgICAgbW9kdWxlc19zZWFyY2guc2VhcmNoKHtcbiAgICAgICAgICAgIGFwaVNldHRpbmdzOiB7XG4gICAgICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9tYXJrZXRwbGFjZS5hZGFwdGNtcy5jb20vYXBpL3NlYXJjaD9xPXtxdWVyeX0nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZmllbGRzOiB7XG4gICAgICAgICAgICAgICAgcmVzdWx0czogJ2l0ZW1zJyxcbiAgICAgICAgICAgICAgICB0aXRsZTogJ25hbWUnLFxuICAgICAgICAgICAgICAgIHVybDogJ2luc3RhbGxfdXJsJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1pbkNoYXJhY3RlcnM6IDNcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgdmFyIHBsdWdpbnNfc2VhcmNoID0gJCgnLnVpLnNlYXJjaC5wbHVnaW5zJyk7XG4gICAgaWYgKHBsdWdpbnNfc2VhcmNoLmxlbmd0aCkge1xuICAgICAgICBwbHVnaW5zX3NlYXJjaC5zZWFyY2goe1xuICAgICAgICAgICAgYXBpU2V0dGluZ3M6IHtcbiAgICAgICAgICAgICAgICB1cmw6ICdodHRwczovL21hcmtldHBsYWNlLmFkYXB0Y21zLmNvbS9hcGkvc2VhcmNoL3BsdWdpbj9xPXtxdWVyeX0nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZmllbGRzOiB7XG4gICAgICAgICAgICAgICAgcmVzdWx0czogJ2l0ZW1zJyxcbiAgICAgICAgICAgICAgICB0aXRsZTogJ25hbWUnLFxuICAgICAgICAgICAgICAgIHVybDogJ2luc3RhbGxfdXJsJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1pbkNoYXJhY3RlcnM6IDNcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgdmFyIHRoZW1lc19zZWFyY2ggPSAkKCcudWkuc2VhcmNoLnRoZW1lcycpO1xuICAgIGlmICh0aGVtZXNfc2VhcmNoLmxlbmd0aCkge1xuICAgICAgICB0aGVtZXNfc2VhcmNoLnNlYXJjaCh7XG4gICAgICAgICAgICBhcGlTZXR0aW5nczoge1xuICAgICAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vbWFya2V0cGxhY2UuYWRhcHRjbXMuY29tL2FwaS9zZWFyY2gvdGhlbWU/cT17cXVlcnl9J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZpZWxkczoge1xuICAgICAgICAgICAgICAgIHJlc3VsdHM6ICdpdGVtcycsXG4gICAgICAgICAgICAgICAgdGl0bGU6ICduYW1lJyxcbiAgICAgICAgICAgICAgICB1cmw6ICdpbnN0YWxsX3VybCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtaW5DaGFyYWN0ZXJzOiAzXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHZhciByYXRpbmdzID0gJCgnLnVpLnJhdGluZycpO1xuICAgIGlmIChyYXRpbmdzLmxlbmd0aCkge1xuICAgICAgICAkLmVhY2gocmF0aW5ncywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICBvblJhdGU6IGZ1bmN0aW9uKHJhdGluZykge1xuICAgICAgICAgICAgICAgICAgJC5wb3N0KF90aGlzLmF0dHIoJ2RhdGEtaHJlZicpLCB7IHJhdGluZzogcmF0aW5nIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygnUmF0aW5nIHNhdmVkJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMubmV4dCgpLmhhc0NsYXNzKCdudW1iZXJzJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLm5leHQoKS5odG1sKCcoJyArIHJlc3BvbnNlLm5ld190b3RhbF9yYXRpbmdzICsgJyknKTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCdDb3VsZCBub3Qgc2F2ZSByYXRpbmcsIHRyeSBhZ2FpbiEnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygnZGlzYWJsZWQnKSkge1xuICAgICAgICAgICAgICAgICQodGhpcykucmF0aW5nKCdkaXNhYmxlJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQodGhpcykucmF0aW5nKHNldHRpbmdzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgdmFyIHNwZWNpYWxfY2FyZHMgPSAkKCcuc3BlY2lhbC5jYXJkcyAuaW1hZ2UnKTtcbiAgICBpZiAoc3BlY2lhbF9jYXJkcy5sZW5ndGgpIHtcbiAgICAgICAgc3BlY2lhbF9jYXJkcy5kaW1tZXIoe1xuICAgICAgICAgICAgb246ICdob3ZlcidcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgdmFyIGNvbGxhcHNpYmxlX2l0ZW1zID0gJCgnLml0ZW0uY29sbGFwc2libGUnKTtcbiAgICBpZiAoY29sbGFwc2libGVfaXRlbXMubGVuZ3RoKSB7XG4gICAgICAgIC8vIHRvZ2dsZSBjb2xsYXBzaWJsZSBtZW51XG4gICAgICAgICQoJy5pdGVtLmNvbGxhcHNpYmxlIC5oZWFkZXInKS5jbGljayhmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIHZhciBtZW51ID0gJCh0aGlzKS5wYXJlbnQoKS5maW5kKCcubWVudScpO1xuXG4gICAgICAgICAgICAvLyBzbyBpdCB3aWxsIGJlIGFjdGl2ZVxuICAgICAgICAgICAgaWYgKG1lbnUuaGFzQ2xhc3MoJ2hpZGRlbicpKSB7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5maW5kKCcuaWNvbicpLnJlbW92ZUNsYXNzKCdyaWdodCcpLmFkZENsYXNzKCdkb3duJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSwgaW5hY3RpdmVcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoJy5pY29uJykucmVtb3ZlQ2xhc3MoJ2Rvd24nKS5hZGRDbGFzcygncmlnaHQnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbWVudS50b2dnbGVDbGFzcygnaGlkZGVuJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGFkZCBhY3RpdmUgY2xhc3NlcyB0byBtZW51IGRpdidzXG4gICAgICAgIC8vIGlmIG9uIGN1cnJlbnQgVVJMXG4gICAgICAgICQuZWFjaChjb2xsYXBzaWJsZV9pdGVtcywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoJCh0aGlzKS5maW5kKCcubWVudSAuaXRlbS5hY3RpdmUnKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoJy5oZWFkZXInKS50cmlnZ2VyKCdjbGljaycpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoJCgnLnRvYy5pdGVtJykubGVuZ3RoKSB7XG4gICAgICAgICQoJy51aS5zaWRlYmFyJykuc2lkZWJhcignYXR0YWNoIGV2ZW50cycsICcudG9jLml0ZW0nKTtcbiAgICB9XG5cbiAgICAvLyB3eXNpd3lnIGVkaXRvcnNcbiAgICB2YXIgd3lzaXd5ZyA9ICQoJy53eXNpd3lnJyk7XG4gICAgaWYgKHd5c2l3eWcubGVuZ3RoKSB7XG4gICAgICAgICQuZWFjaCh3eXNpd3lnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdjb2RlLXZpZXcnKSAmJiAkKCcuYXBpLWNhbGwnKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGV4dGFyZWEgPSAkKHRoaXMpLmdldCgwKTtcbiAgICAgICAgICAgICAgICB2YXIgYXBpX3VybCA9ICQoJy5hcGktY2FsbCcpLmF0dHIoJ2RhdGEtdXJsJyk7XG5cbiAgICAgICAgICAgICAgICAkLmdldChhcGlfdXJsLCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdG9yID0gQ29kZU1pcnJvci5mcm9tVGV4dEFyZWEodGV4dGFyZWEsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU6ICdzY2hlbWUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZU51bWJlcnM6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvci5nZXREb2MoKS5zZXRWYWx1ZShyZXNwb25zZS5yZXN1bHRzWzBdLmJvZHkpO1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG8gbm90aGluZywgbm8gdmFsdWUgcHJlc2VudFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgJ2pzb24nKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgQ0tFRElUT1IucmVwbGFjZSgkKHRoaXMpLmF0dHIoJ2lkJykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59KTtcblxuLy8gU291cmNlOiBodHRwczovL2dpc3QuZ2l0aHViLmNvbS9tYXRoZXdieXJuZS8xMjgwMjg2XG5mdW5jdGlvbiBzbHVnaWZ5KHRleHQpIHtcbiAgICByZXR1cm4gdGV4dC50b1N0cmluZygpLnRvTG93ZXJDYXNlKClcbiAgICAgICAgLnJlcGxhY2UoL1xccysvZywgJy0nKSAvLyBSZXBsYWNlIHNwYWNlcyB3aXRoIC1cbiAgICAgICAgLnJlcGxhY2UoL1teXFx3XFwtXSsvZywgJycpIC8vIFJlbW92ZSBhbGwgbm9uLXdvcmQgY2hhcnNcbiAgICAgICAgLnJlcGxhY2UoL1xcLVxcLSsvZywgJy0nKSAvLyBSZXBsYWNlIG11bHRpcGxlIC0gd2l0aCBzaW5nbGUgLVxuICAgICAgICAucmVwbGFjZSgvXi0rLywgJycpIC8vIFRyaW0gLSBmcm9tIHN0YXJ0IG9mIHRleHRcbiAgICAgICAgLnJlcGxhY2UoLy0rJC8sICcnKTsgLy8gVHJpbSAtIGZyb20gZW5kIG9mIHRleHRcbn0iXX0=
